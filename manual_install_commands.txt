# Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù€ AI Translator v2.2.4
# Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… 5.31.55.179

# ===== Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… =====
ssh eg2@5.31.55.179
# ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 1q1

# ===== ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
sudo apt update
sudo apt install -y unzip wget curl git python3-pip python3-venv

# ===== ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ =====
cd /home/eg2
wget -O ai-translator.zip https://github.com/AbdelmonemAwad/ai-translator/archive/refs/heads/main.zip
unzip ai-translator.zip
mv ai-translator-main ai-translator
rm ai-translator.zip
cd ai-translator

# ===== Ø¥Ø¹Ø¯Ø§Ø¯ Python =====
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install flask flask-sqlalchemy gunicorn requests psutil werkzeug

# ===== Ø¥Ù†Ø´Ø§Ø¡ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ± =====
mkdir -p static/js

cat > static/js/ultimate-tabs-fix.js << 'EOF'
console.log('ðŸš€ Ultimate Tabs Fix Loading...');

document.addEventListener('DOMContentLoaded', function() {
    let isInitialized = false;
    
    function initializeTabs() {
        if (isInitialized) return;
        
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        
        if (!categorySelect || !subcategorySelect) {
            setTimeout(initializeTabs, 1000);
            return;
        }
        
        const mapping = {
            'general': {
                sections: [
                    { id: 'DEFAULT', name: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' },
                    { id: 'LANGUAGE', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„ØºØ©' },
                    { id: 'UI', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©' }
                ]
            },
            'ai': {
                sections: [
                    { id: 'WHISPER', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Whisper' },
                    { id: 'OLLAMA', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ollama' },
                    { id: 'GPU', name: 'Ø¥Ø¯Ø§Ø±Ø© GPU' },
                    { id: 'API', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API' }
                ]
            },
            'media': {
                sections: [
                    { id: 'PLEX', name: 'Plex Media Server' },
                    { id: 'JELLYFIN', name: 'Jellyfin Media Server' },
                    { id: 'EMBY', name: 'Emby Media Server' },
                    { id: 'RADARR', name: 'Radarr (Ø£ÙÙ„Ø§Ù…)' },
                    { id: 'SONARR', name: 'Sonarr (Ù…Ø³Ù„Ø³Ù„Ø§Øª)' }
                ]
            },
            'system': {
                sections: [
                    { id: 'PATHS', name: 'Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª' },
                    { id: 'DATABASE', name: 'Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' },
                    { id: 'SERVER', name: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…' }
                ]
            }
        };
        
        function findAvailableSections() {
            const available = [];
            Object.values(mapping).flatMap(cat => cat.sections).forEach(section => {
                if (document.querySelector('#tab-' + section.id)) {
                    available.push(section.id);
                }
            });
            return available;
        }
        
        const availableSections = findAvailableSections();
        
        function hideAllTabs() {
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.add('hidden');
            });
        }
        
        function showTab(sectionId) {
            hideAllTabs();
            const tab = document.querySelector('#tab-' + sectionId);
            if (tab) {
                tab.style.display = 'block';
                tab.classList.remove('hidden');
                setTimeout(() => tab.scrollIntoView({ behavior: 'smooth' }), 100);
                return true;
            }
            return false;
        }
        
        function updateSubcategories(categoryKey) {
            subcategorySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';
            const category = mapping[categoryKey];
            if (!category) return;
            
            const available = category.sections.filter(s => availableSections.includes(s.id));
            available.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.name;
                subcategorySelect.appendChild(option);
            });
            
            if (available.length > 0) {
                subcategorySelect.value = available[0].id;
                showTab(available[0].id);
            }
        }
        
        categorySelect.addEventListener('change', function() {
            updateSubcategories(this.value);
        });
        
        subcategorySelect.addEventListener('change', function() {
            if (this.value) showTab(this.value);
            else hideAllTabs();
        });
        
        updateSubcategories(categorySelect.value || 'general');
        
        window.ultimateDebugTabs = function() {
            return { availableSections, category: categorySelect.value, subcategory: subcategorySelect.value };
        };
        
        window.ultimateShowSection = showTab;
        
        isInitialized = true;
        console.log('âœ… Ultimate Tabs System Ready!');
    }
    
    setTimeout(initializeTabs, 1000);
});
EOF

# ===== ØªØ­Ø¯ÙŠØ« layout.html =====
if [[ -f "templates/layout.html" ]]; then
    sed -i 's|</body>|    <script src="{{ url_for('\''static'\'', filename='\''js/ultimate-tabs-fix.js'\'') }}"></script>\n</body>|' templates/layout.html
    echo "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« layout.html"
fi

# ===== Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¨ÙŠØ¦Ø© Ø¨Ø³ÙŠØ· =====
cat > .env << 'ENV'
FLASK_APP=main.py
FLASK_ENV=development
SESSION_SECRET=your-secret-key-here
ENV

# ===== ØªØ¬Ø±Ø¨Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
source venv/bin/activate
source .env
python3 -c "
try:
    from app import app
    print('âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­')
    print('ðŸŒ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„Ù‡ Ø¨Ù€: python3 -m flask run --host=0.0.0.0 --port=5000')
except Exception as e:
    print('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', e)
"

# ===== ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± =====
echo "ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 5000..."
python3 -m flask run --host=0.0.0.0 --port=5000 &

# ===== ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ =====
sleep 5
curl -I http://localhost:5000/ || echo "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨"

echo "ðŸŽ‰ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…ÙƒØªÙ…Ù„!"
echo "ðŸŒ Ø§Ù„Ø±Ø§Ø¨Ø·: http://5.31.55.179:5000"
echo "ðŸ”‘ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin"
echo "ðŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: your_strong_password"

# ===== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© =====
echo ""
echo "ðŸ’¡ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª:"
echo "1. Ø§ÙØªØ­ http://5.31.55.179:5000"
echo "2. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø°Ù‡Ø¨ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"
echo "3. Ø§Ø¶ØºØ· F12 ÙˆØ´ØºÙ„: ultimateDebugTabs()"
echo "4. Ø§Ø³ØªØ®Ø¯Ù…: ultimateShowSection('DEFAULT')"
echo ""
echo "ðŸ”§ Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: killall python3"
echo "ðŸ”§ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: cd /home/eg2/ai-translator && source venv/bin/activate && python3 -m flask run --host=0.0.0.0 --port=5000"