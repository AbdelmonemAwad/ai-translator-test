{% extends "layout.html" %}
{% block title %}{{ t('settings') }} - {{ t('app_name') }}{% endblock %}
{% block content %}
<div class="panel">
    <div class="panel-header">
        <h2>{{ t('application_settings') }}</h2>
        <div class="settings-actions">
            <button class="action-btn" onclick="saveAllSettings()" style="background-color: var(--accent-green);">
                <i data-feather="save"></i>
                {{ t('save_all') }}
            </button>
        </div>
    </div>
    <div class="settings-navigation">
        <div class="navigation-header">
            <h3 style="color: var(--text-primary); margin: 0;">{{ t('settings_navigation') }}</h3>
        </div>
        
        <div class="category-dropdown-container">
            <div class="dropdown-group">
                <label for="category-select" class="dropdown-label">{{ t('settings_category') }}:</label>
                <select id="category-select" class="category-select" onchange="switchCategory()">
                    <option value="general">ğŸ”§ {{ t('general_category') }}</option>
                    <option value="ai">ğŸ¤– {{ t('ai_category') }}</option>
                    <option value="media">ğŸ“º {{ t('media_category') }}</option>
                    <option value="system">âš™ï¸ {{ t('system_category') }}</option>
                    <option value="development">ğŸ› ï¸ {{ t('development_category') }}</option>
                </select>
            </div>
            
            <div class="dropdown-group">
                <label for="subcategory-select" class="dropdown-label">{{ t('settings_subcategory') }}:</label>
                <select id="subcategory-select" class="subcategory-select" onchange="switchTab()">
                    <!-- Options populated by JavaScript -->
                </select>
            </div>
        </div>
    </div>

    <form method="post" action="{{ url_for('settings_page') }}">
        {% for section, items in settings_by_section.items() %}
        <div class="tab-content {% if not loop.first %}hidden{% endif %}" id="tab-{{ section }}">
            <div class="form-section">
                <!-- Service Integration Help -->
                {% if section == 'PLEX' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-primary); margin-bottom: 15px;">
                            <i data-feather="info"></i> {{ t('plex_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('plex_step_1') }}</li>
                                <li>{{ t('plex_step_2') }}</li>
                                <li>{{ t('plex_step_3') }}</li>
                                <li>{{ t('plex_step_4') }}</li>
                            </ol>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> Token: X-Plex-Token=xxxxxxxxxxxxxxxxxxxx
                        </p>
                    </div>
                {% elif section == 'JELLYFIN' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-primary); margin-bottom: 15px;">
                            <i data-feather="info"></i> {{ t('jellyfin_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('jellyfin_step_1') }}</li>
                                <li>{{ t('jellyfin_step_2') }}</li>
                                <li>{{ t('jellyfin_step_3') }}</li>
                                <li>{{ t('jellyfin_step_4') }}</li>
                            </ol>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> API Key: 1234567890abcdef1234567890abcdef
                        </p>
                    </div>
                {% elif section == 'EMBY' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-primary); margin-bottom: 15px;">
                            <i data-feather="info"></i> {{ t('emby_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('emby_step_1') }}</li>
                                <li>{{ t('emby_step_2') }}</li>
                                <li>{{ t('emby_step_3') }}</li>
                                <li>{{ t('emby_step_4') }}</li>
                            </ol>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> API Key: abcdef1234567890abcdef1234567890
                        </p>
                    </div>
                {% elif section == 'KODI' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-primary); margin-bottom: 15px;">
                            <i data-feather="info"></i> {{ t('kodi_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('kodi_step_1') }}</li>
                                <li>{{ t('kodi_step_2') }}</li>
                                <li>{{ t('kodi_step_3') }}</li>
                                <li>{{ t('kodi_step_4') }}</li>
                            </ol>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> URL: http://192.168.1.100:8080/jsonrpc
                        </p>
                    </div>
                {% elif section == 'RADARR' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-success);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-success); margin-bottom: 15px;">
                            <i data-feather="film"></i> {{ t('radarr_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('radarr_step_1') }}</li>
                                <li>{{ t('radarr_step_2') }}</li>
                                <li>{{ t('radarr_step_3') }}</li>
                                <li>{{ t('radarr_step_4') }}</li>
                                <li>{{ t('radarr_step_5') }}</li>
                                <li>{{ t('radarr_step_6') }}</li>
                            </ol>
                            <p style="color: var(--text-warning); font-size: 0.9em;">
                                ğŸ“ {{ t('radarr_description') }}
                            </p>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> http://localhost:7878 | API Key: 1234567890abcdef1234567890abcdef
                        </p>
                    </div>
                {% elif section == 'SONARR' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-info);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-info); margin-bottom: 15px;">
                            <i data-feather="tv"></i> {{ t('sonarr_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('sonarr_step_1') }}</li>
                                <li>{{ t('sonarr_step_2') }}</li>
                                <li>{{ t('sonarr_step_3') }}</li>
                                <li>{{ t('sonarr_step_4') }}</li>
                                <li>{{ t('sonarr_step_5') }}</li>
                                <li>{{ t('sonarr_step_6') }}</li>
                            </ol>
                            <p style="color: var(--text-warning); font-size: 0.9em;">
                                ğŸ“º {{ t('sonarr_description') }}
                            </p>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> http://localhost:8989 | API Key: abcdef1234567890abcdef1234567890
                        </p>
                    </div>
                {% elif section == 'API' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-warning);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-warning); margin-bottom: 15px;">
                            <i data-feather="cpu"></i> {{ t('ollama_setup_guide') }}
                        </h4>
                        <div>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('ollama_step_1') }}</li>
                                <li>{{ t('ollama_step_2') }}</li>
                                <li>{{ t('ollama_step_3') }}</li>
                                <li>{{ t('ollama_step_4') }}</li>
                            </ol>
                            <p style="color: var(--text-warning); font-size: 0.9em;">
                                ğŸ¤– {{ t('ollama_description') }}
                            </p>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('example') }}:</strong> http://localhost:11434 | Command: ollama pull llama3
                        </p>
                    </div>
                {% elif section == 'SERVER' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-blue);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-blue); margin-bottom: 15px;">
                            <i data-feather="server"></i> 
                            {% if get_user_language() == 'ar' %}
                                Ø¯Ù„ÙŠÙ„ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Ø¯Ù…
                            {% else %}
                                Server Configuration Guide
                            {% endif %}
                        </h4>
                        <div>
                            <p style="color: var(--text-primary); font-size: 0.9em; margin-bottom: 15px;">
                                {% if get_user_language() == 'ar' %}
                                    ğŸŒ ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø´Ø¨ÙƒØ© Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆØ¹Ù†ÙˆØ§Ù† IP ÙˆÙ…Ù†ÙØ° Ø§Ù„Ø§ØªØµØ§Ù„. Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ­Ø¯Ø¯ ÙƒÙŠÙÙŠØ© ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚.
                                {% else %}
                                    ğŸŒ Control server network settings, IP address and connection port. These settings determine how users access the application.
                                {% endif %}
                            </p>
                            
                            <!-- Current Server Status -->
                            <div id="current-server-info" style="background: var(--accent-info-bg, rgba(59, 130, 246, 0.1)); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid var(--accent-info);">
                                <p style="color: var(--accent-info); margin: 0; font-weight: bold;">
                                    {% if get_user_language() == 'ar' %}
                                        ğŸ“ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰: <span id="current-host-display">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>:<span id="current-port-display">5000</span>
                                    {% else %}
                                        ğŸ“ Current server running on: <span id="current-host-display">Loading...</span>:<span id="current-port-display">5000</span>
                                    {% endif %}
                                </p>
                            </div>
                            
                            <div style="background: var(--accent-warning-bg, rgba(245, 158, 11, 0.1)); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid var(--accent-warning);">
                                <p style="color: var(--accent-warning); margin: 0; font-weight: bold;">
                                    {% if get_user_language() == 'ar' %}
                                        âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©: ÙÙŠ Ø¨ÙŠØ¦Ø© ReplitØŒ ØªØºÙŠÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³ÙŠØ­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ„ÙƒÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø³ÙŠØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¶Ø­ Ø£Ø¹Ù„Ø§Ù‡.
                                    {% else %}
                                        âš ï¸ Important Note: In Replit environment, changing these settings will save new values but the current application will remain on the address shown above.
                                    {% endif %}
                                </p>
                            </div>
                            <h5 style="color: var(--accent-info); margin-bottom: 10px;">
                                {% if get_user_language() == 'ar' %}
                                    Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:
                                {% else %}
                                    Available Settings:
                                {% endif %}
                            </h5>
                            <ul style="margin: 10px 0; padding-right: 20px;">
                                {% if get_user_language() == 'ar' %}
                                    <li><strong>Ø¹Ù†ÙˆØ§Ù† IP Ù„Ù„Ø®Ø§Ø¯Ù…:</strong> ÙŠØ­Ø¯Ø¯ Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚. Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¸Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡ ÙˆØ³ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
                                    <li><strong>Ù…Ù†ÙØ° Ø§Ù„Ø®Ø§Ø¯Ù…:</strong> Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡</li>
                                    <li><strong>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„:</strong> 
                                        <ul style="margin-top: 5px;">
                                            <li>Ù„Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©: Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ø£Ø¹Ù„Ø§Ù‡</li>
                                            <li>Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·: Ø§Ø³ØªØ®Ø¯Ù… 127.0.0.1</li>
                                            <li>Ù„Ø´Ø¨ÙƒØ© Ù…Ø­Ø¯Ø¯Ø©: Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</li>
                                        </ul>
                                    </li>
                                {% else %}
                                    <li><strong>Server IP Address:</strong> Determines who can access the application. Current value shown above will be the default in settings</li>
                                    <li><strong>Server Port:</strong> Port number on which the application runs. Current port shown above</li>
                                    <li><strong>Access Options:</strong> 
                                        <ul style="margin-top: 5px;">
                                            <li>For access from all devices: Use the current address shown above</li>
                                            <li>For local access only: Use 127.0.0.1</li>
                                            <li>For specific network: Enter the desired network IP address</li>
                                        </ul>
                                    </li>
                                {% endif %}
                            </ul>
                            <h5 style="color: var(--accent-info); margin: 15px 0 10px;">
                                {% if get_user_language() == 'ar' %}
                                    Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†:
                                {% else %}
                                    Security Guidelines:
                                {% endif %}
                            </h5>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                {% if get_user_language() == 'ar' %}
                                    <li>Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥ØªØ§Ø­Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</li>
                                    <li>Ù„Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ: Ø§Ø³ØªØ®Ø¯Ù… 127.0.0.1 Ù„Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ù†ÙØ³Ù‡ ÙÙ‚Ø·</li>
                                    <li>ØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ù†Ø§ÙØ° Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© (Ù…Ù† 1 Ø¥Ù„Ù‰ 1023) ÙˆØ§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†Ø§ÙØ° Ø§Ù„Ø¹Ù„ÙŠØ§ Ù…Ø«Ù„ 5000ØŒ 8000ØŒ 3000</li>
                                    <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ù…Ø®ØªØ§Ø± Ù…ØªØ§Ø­ ÙˆØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙˆØ§Ø³Ø·Ø© ØªØ·Ø¨ÙŠÙ‚ Ø¢Ø®Ø±</li>
                                {% else %}
                                    <li>For public access: Use the current address shown above to allow access from all devices</li>
                                    <li>For local security: Use 127.0.0.1 for access from the same device only</li>
                                    <li>Avoid reserved ports (1-1023) and use higher ports like 5000, 8000, 3000</li>
                                    <li>Ensure the chosen port is available and not used by another application</li>
                                {% endif %}
                            </ol>
                        </div>
                    </div>
                {% elif section == 'GPU' %}
                    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
                    <div class="gpu-management-section">
                        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù… -->
                        <div class="card mb-4" style="background: var(--card-bg); border: 2px solid #9b59b6; border-radius: 16px; box-shadow: 0 4px 20px rgba(155, 89, 182, 0.15);">
                            <div class="card-header text-center" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                                <i data-feather="cpu" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                                <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                    {{ 'Ø­Ø§Ù„Ø© ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©' if session.get('language', 'ar') == 'ar' else 'GPU Status' }}
                                </h4>
                                <small style="opacity: 0.9; margin-top: 8px; display: block; font-size: 0.95em;">
                                    {{ 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©' if session.get('language', 'ar') == 'ar' else 'Available GPU information and management' }}
                                </small>
                            </div>
                            <div class="card-body" style="padding: 30px; background: rgba(155, 89, 182, 0.02);">
                                <div style="padding: 30px; text-align: center; background: rgba(155, 89, 182, 0.05); border-radius: 12px; border: 2px dashed rgba(155, 89, 182, 0.3);">
                                    <i data-feather="info" style="width: 48px; height: 48px; color: #9b59b6; margin-bottom: 15px;"></i>
                                    <h4 style="color: #9b59b6; margin-bottom: 10px;">{{ 'ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹Ø·Ù„Ø©' if session.get('language', 'ar') == 'ar' else 'GPU Features Disabled' }}</h4>
                                    <p style="color: var(--text-secondary); margin: 0; line-height: 1.5;">
                                        {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹Ø·Ù„Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡' if session.get('language', 'ar') == 'ar' else 'GPU settings temporarily disabled for performance optimization' }}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© -->
                        <div class="card mb-4" style="background: var(--card-bg); border: 2px solid #e74c3c; border-radius: 16px; box-shadow: 0 4px 20px rgba(231, 76, 60, 0.15);">
                            <div class="card-header text-center" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                                <i data-feather="settings" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                                <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                    {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©' if session.get('language', 'ar') == 'ar' else 'GPU Settings' }}
                                </h4>
                                <small style="opacity: 0.9; margin-top: 8px; display: block; font-size: 0.95em;">
                                    {{ 'ØªØ®ØµÙŠØµ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' if session.get('language', 'ar') == 'ar' else 'Assign GPUs to AI services' }}
                                </small>
                            </div>
                            <div class="card-body" style="padding: 30px; background: rgba(231, 76, 60, 0.02);">
                                {% for item in items %}
                                    {% if item.key in ['whisper_model_gpu', 'ollama_model_gpu'] %}
                                        <div class="mb-4">
                                            <label for="{{ item.key }}" class="form-label" style="font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                                {% if 'whisper' in item.key %}
                                                    <i data-feather="mic" style="width: 20px; height: 20px; color: #e74c3c;"></i>
                                                {% else %}
                                                    <i data-feather="brain" style="width: 20px; height: 20px; color: #e74c3c;"></i>
                                                {% endif %}
                                                <span style="font-size: 1.1em;">{{ item.translated_description }}</span>
                                            </label>
                                            
                                            <select class="form-control gpu-select" id="{{ item.key }}" name="{{ item.key }}"
                                                    style="border-radius: 12px; padding: 16px 20px; border: 2px solid #f8d7da; font-size: 1.05em; background: white;">
                                                {% for option in item.option_list %}
                                                    <option value="{{ option.value }}" {% if item.value == option.value %}selected{% endif %}>
                                                        {{ option.label }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                                
                                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© -->
                                <div style="margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                                    <button type="button" onclick="refreshGPUOptions()" 
                                            class="btn gpu-btn" 
                                            style="background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; border: none; border-radius: 12px; padding: 15px 25px; font-size: 1em; font-weight: 600; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); transition: all 0.3s ease;">
                                        <i data-feather="refresh-cw" style="width: 20px; height: 20px; margin-right: 10px;"></i>
                                        {{ 'ØªØ­Ø¯ÙŠØ« ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©' if session.get('language', 'ar') == 'ar' else 'Refresh GPU Options' }}
                                    </button>
                                    
                                    <button type="button" onclick="smartGPUAllocation()" 
                                            class="btn gpu-btn" 
                                            style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; border-radius: 12px; padding: 15px 25px; font-size: 1em; font-weight: 600; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); transition: all 0.3s ease;">
                                        <i data-feather="zap" style="width: 20px; height: 20px; margin-right: 10px;"></i>
                                        {{ 'ØªÙˆØ²ÙŠØ¹ Ø°ÙƒÙŠ' if session.get('language', 'ar') == 'ar' else 'Smart Allocation' }}
                                    </button>
                                    
                                    <button type="button" onclick="openGPUDiagnosis()" 
                                            class="btn gpu-btn" 
                                            style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; border-radius: 12px; padding: 15px 25px; font-size: 1em; font-weight: 600; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3); transition: all 0.3s ease;">
                                        <i data-feather="tool" style="width: 20px; height: 20px; margin-right: 10px;"></i>
                                        {{ 'Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª' if session.get('language', 'ar') == 'ar' else 'Installation Helper' }}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
                        <div class="card mb-4" style="background: var(--card-bg); border: 2px solid #f39c12; border-radius: 16px; box-shadow: 0 4px 20px rgba(243, 156, 18, 0.15);">
                            <div class="card-header text-center" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                                <i data-feather="zap" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                                <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                    {{ 'Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©' if session.get('language', 'ar') == 'ar' else 'Recommendations & Help' }}
                                </h4>
                            </div>
                            <div class="card-body" style="padding: 30px; background: rgba(243, 156, 18, 0.02);">
                                <div id="gpu-recommendations" style="min-height: 100px;">
                                    <div style="text-align: center; color: var(--text-secondary);">
                                        {{ 'Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…' if session.get('language', 'ar') == 'ar' else 'Recommendations will appear here after system scan' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                {% elif section == 'REMOTE_STORAGE' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-warning);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-warning); margin-bottom: 15px;">
                            <i data-feather="server"></i> {{ t('remote_storage_setup_guide') }}
                        </h4>
                        <div>
                            <p style="color: var(--text-warning); font-size: 0.9em; margin-bottom: 15px;">
                                ğŸ”— {{ t('remote_storage_description') }}
                            </p>
                            <h5 style="color: var(--accent-info); margin-bottom: 10px;">{{ t('supported_protocols') }}:</h5>
                            <ul style="margin: 10px 0; padding-right: 20px;">
                                <li><strong>SFTP (SSH):</strong> {{ t('sftp_description') }}</li>
                                <li><strong>FTP:</strong> {{ t('ftp_description') }}</li>
                                <li><strong>SMB/CIFS:</strong> {{ t('smb_description') }}</li>
                                <li><strong>NFS:</strong> {{ t('nfs_description') }}</li>
                            </ul>
                            <h5 style="color: var(--accent-info); margin: 15px 0 10px;">{{ t('setup_steps') }}:</h5>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('remote_step_1') }}</li>
                                <li>{{ t('remote_step_2') }}</li>
                                <li>{{ t('remote_step_3') }}</li>
                                <li>{{ t('remote_step_4') }}</li>
                                <li>{{ t('remote_step_5') }}</li>
                                <li>{{ t('remote_step_6') }}</li>
                                <li>{{ t('remote_step_7') }}</li>
                            </ol>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                            <div id="remote-storage-controls" style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button type="button" id="test-remote-connection" class="btn btn-warning">
                                    <i data-feather="wifi"></i> {{ t('test_connection') }}
                                </button>
                                <button type="button" id="view-mount-status" class="btn btn-info">
                                    <i data-feather="monitor"></i> {{ t('mount_status') }}
                                </button>
                                <button type="button" id="unmount-remote" class="btn btn-danger">
                                    <i data-feather="x-circle"></i> {{ t('unmount') }}
                                </button>
                            </div>
                            <div id="remote-storage-status" style="min-height: 40px; padding: 10px; background: var(--bg-primary); border-radius: 4px; font-family: monospace; font-size: 0.9em;">
                                {{ t('ready_to_test') }}
                            </div>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('remote_storage_examples') }}:</strong><br>
                            SFTP: user@192.168.1.100:/volume1/media<br>
                            SMB: \\192.168.1.100\shared\movies<br>
                            NFS: 192.168.1.100:/export/media<br><br>
                            <strong>{{ t('local_mount_examples') }}:</strong><br>
                            Movies: /mnt/remote/movies<br>
                            Series: /mnt/remote/series<br>
                            Complete: /mnt/remote/movies/complete
                        </p>
                    </div>
                {% elif section == 'PATHS' %}
                    <div class="help-section" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-info);">
                        <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-info); margin-bottom: 15px;">
                            <i data-feather="folder"></i> {{ t('file_paths_setup_guide') }}
                        </h4>
                        <div>
                            <p style="color: var(--text-warning); font-size: 0.9em; margin-bottom: 15px;">
                                ğŸ“ {{ t('paths_description') }}
                            </p>
                            <h5 style="color: var(--accent-info); margin-bottom: 10px;">{{ t('path_types') }}:</h5>
                            <ul style="margin: 10px 0; padding-right: 20px;">
                                <li><strong>{{ t('remote_paths') }}:</strong> {{ t('remote_paths_desc') }}</li>
                                <li><strong>{{ t('local_mounts') }}:</strong> {{ t('local_mounts_desc') }}</li>
                                <li><strong>{{ t('path_mapping') }}:</strong> {{ t('path_mapping_desc') }}</li>
                            </ul>
                            <h5 style="color: var(--accent-info); margin: 15px 0 10px;">{{ t('setup_steps') }}:</h5>
                            <ol style="margin: 10px 0; padding-right: 20px;">
                                <li>{{ t('paths_step_1') }}</li>
                                <li>{{ t('paths_step_2') }}</li>
                                <li>{{ t('paths_step_3') }}</li>
                                <li>{{ t('paths_step_4') }}</li>
                            </ol>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>{{ t('path_mapping_example') }}:</strong>
                            <div style="margin-top: 10px; font-family: monospace; font-size: 0.9em;">
                                <div style="color: var(--accent-info); margin-bottom: 5px;">{{ t('remote_storage') }}:</div>
                                <div style="margin-bottom: 10px; padding: 5px; background: var(--bg-primary); border-radius: 4px;">
                                    â€¢ {{ t('movies') }}: /volume1/Download/complete<br>
                                    â€¢ {{ t('series') }}: /volume1/tv show download
                                </div>
                                <div style="color: var(--accent-success); margin-bottom: 5px;">{{ t('local_mount') }}:</div>
                                <div style="padding: 5px; background: var(--bg-primary); border-radius: 4px;">
                                    â€¢ {{ t('movies') }}: /mnt/remote/movies/complete<br>
                                    â€¢ {{ t('series') }}: /mnt/remote/tv
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">
                            <strong>{{ t('important_note') }}:</strong> {{ t('paths_note') }}
                        </p>
                    </div>
                    

                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
                    <div class="alert" style="background: var(--bg-secondary); border: 1px solid var(--accent-info); border-radius: 8px; padding: 20px; margin-top: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i data-feather="info" style="width: 20px; height: 20px; color: var(--accent-info);"></i>
                            <strong style="color: var(--accent-info);">
                                {{ 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©' if session.get('language', 'ar') == 'ar' else 'Important Information' }}
                            </strong>
                        </div>
                        <p style="margin: 0; color: var(--text-secondary); line-height: 1.6;">
                            {{ 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø¹ÙŠØ¯ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ø¹ÙŠØ¯ (NAS/Synology), Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ Ø­ÙŠØ« ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.' if session.get('language', 'ar') == 'ar' else 'Remote storage refers to paths on the remote server (NAS/Synology), while local mount refers to mount points on the local server where the application runs.' }}
                        </p>
                    </div>
                {% endif %}

                
                {% if section == 'REMOTE_STORAGE' %}
                    {% set field_groups = {
                        'connection': ['remote_storage_enabled', 'remote_storage_protocol', 'remote_storage_host', 'remote_storage_port', 'remote_storage_test_connection'],
                        'authentication': ['remote_storage_username', 'remote_storage_password'],
                        'mount_configuration': ['remote_storage_mount_point', 'remote_storage_remote_path', 'remote_storage_filesystem_type', 'remote_storage_mount_options'],
                        'auto_settings': ['remote_storage_auto_mount']
                    } %}
                    
                    {% set group_titles = {
                        'connection': {'ar': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„', 'en': 'Connection Settings'},
                        'authentication': {'ar': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'en': 'Authentication Settings'},
                        'mount_configuration': {'ar': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'en': 'Mount Configuration'},
                        'auto_settings': {'ar': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'en': 'Automatic Settings'}
                    } %}
                    
                    {% for group_key, field_keys in field_groups.items() %}
                        {% set group_fields = items | selectattr('key', 'in', field_keys) | list %}
                        {% if group_fields %}
                            {% if group_key == 'mount_configuration' %}
                                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† -->
                                <div class="card mb-4" style="background: var(--card-bg); border: 2px solid #ff9800; border-radius: 16px; box-shadow: 0 4px 20px rgba(255, 152, 0, 0.15);">
                                    <div class="card-header text-center" style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                                        <i data-feather="hard-drive" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                                        <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                            {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„' if session.get('language', 'ar') == 'ar' else 'Mount Configuration' }}
                                        </h4>
                                        <small style="opacity: 0.9; margin-top: 8px; display: block; font-size: 0.95em;">
                                            {{ 'ØªÙƒÙˆÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø¹ÙŠØ¯' if session.get('language', 'ar') == 'ar' else 'Configure remote storage mount points' }}
                                        </small>
                                    </div>
                                    <div class="card-body" style="padding: 30px; background: rgba(255, 152, 0, 0.02);">
                                        {% for item in group_fields %}
                                            <div class="mb-4">
                                                <label for="{{ item.key }}" class="form-label" style="font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                                    {% if 'mount_point' in item.key %}
                                                        <i data-feather="target" style="width: 20px; height: 20px; color: #ff9800;"></i>
                                                    {% elif 'remote_path' in item.key %}
                                                        <i data-feather="folder" style="width: 20px; height: 20px; color: #ff9800;"></i>
                                                    {% elif 'filesystem' in item.key %}
                                                        <i data-feather="database" style="width: 20px; height: 20px; color: #ff9800;"></i>
                                                    {% else %}
                                                        <i data-feather="settings" style="width: 20px; height: 20px; color: #ff9800;"></i>
                                                    {% endif %}
                                                    <span style="font-size: 1.1em;">{{ item.translated_description }}</span>
                                                </label>
                                                
                                                {% if item.type == 'password' %}
                                                    <input type="password" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                           placeholder="******** ({{ t('leave_empty_no_change') }})"
                                                           style="border-radius: 12px; padding: 16px 20px; border: 2px solid #fff3e0; font-size: 1.05em;">
                                                {% elif item.type == 'select' %}
                                                    <select class="form-control" id="{{ item.key }}" name="{{ item.key }}"
                                                            style="border-radius: 12px; padding: 16px 20px; border: 2px solid #fff3e0; font-size: 1.05em;">
                                                        {% for option in item.option_list %}
                                                            <option value="{{ option.value }}" {% if item.value == option.value %}selected{% endif %}>
                                                                {{ option.label }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                {% elif (item.key.endswith('_path') or item.key.endswith('_mount') or item.key.endswith('_point') or item.key.endswith('_root')) and item.type != 'select' %}
                                                    <div class="input-group">
                                                        <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                               value="{{ item.value }}"
                                                               style="border-radius: 12px 0 0 12px; padding: 16px 20px; border: 2px solid #fff3e0; font-size: 1.05em;">
                                                        <div class="input-group-append">
                                                            <button type="button" class="btn browse-btn" data-target="{{ item.key }}"
                                                                    style="background: #ff9800; color: white; border: 2px solid #ff9800; border-radius: 0 12px 12px 0; padding: 16px 20px; font-weight: 600;">
                                                                <i data-feather="folder" style="width: 20px; height: 20px;"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                           value="{{ item.value }}"
                                                           style="border-radius: 12px; padding: 16px 20px; border: 2px solid #fff3e0; font-size: 1.05em;">
                                                {% endif %}
                                                
                                                {% if 'mount_point' in item.key %}
                                                    <small style="color: #666; margin-top: 8px; display: block; font-style: italic;">
                                                        {{ 'Ù…Ø«Ø§Ù„: /mnt/remote' if session.get('language', 'ar') == 'ar' else 'Example: /mnt/remote' }}
                                                    </small>
                                                {% elif 'remote_path' in item.key %}
                                                    <small style="color: #666; margin-top: 8px; display: block; font-style: italic;">
                                                        {{ 'Ù…Ø«Ø§Ù„: /volume1/data' if session.get('language', 'ar') == 'ar' else 'Example: /volume1/data' }}
                                                    </small>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% else %}
                                <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­Ø³Ù† -->
                                {% set group_colors = {
                                    'connection': '#3498db',
                                    'authentication': '#e74c3c', 
                                    'auto_settings': '#9b59b6',
                                    'mount_config': '#ff9800',
                                    'mount_paths': '#ff5722'
                                } %}
                                {% set group_color = group_colors.get(group_key, '#3498db') %}
                                
                                <div class="card mb-4" style="background: var(--card-bg); border: 2px solid {{ group_color }}; border-radius: 16px; box-shadow: 0 4px 20px rgba({{ group_color | replace('#', '') }}, 0.15);">
                                    <div class="card-header text-center" style="background: linear-gradient(135deg, {{ group_color }}, {{ group_color }}dd); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                                        <i data-feather="{% if group_key == 'connection' %}wifi{% elif group_key == 'authentication' %}key{% elif group_key == 'auto_settings' %}settings{% else %}settings{% endif %}" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                                        <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                            {% if group_key == 'connection' %}
                                                {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„' if session.get('language', 'ar') == 'ar' else 'Connection Settings' }}
                                            {% elif group_key == 'authentication' %}
                                                {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©' if session.get('language', 'ar') == 'ar' else 'Authentication Settings' }}
                                            {% elif group_key == 'auto_settings' %}
                                                {{ 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©' if session.get('language', 'ar') == 'ar' else 'Automatic Settings' }}
                                            {% elif group_key == 'mount_config' %}
                                                {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„' if session.get('language', 'ar') == 'ar' else 'Mount Configuration' }}
                                            {% elif group_key == 'mount_paths' %}
                                                {{ 'Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„' if session.get('language', 'ar') == 'ar' else 'Mount Paths' }}
                                            {% endif %}
                                        </h4>
                                        <small style="opacity: 0.9; margin-top: 8px; display: block; font-size: 0.95em;">
                                            {% if group_key == 'connection' %}
                                                {{ 'ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ø¹ÙŠØ¯' if session.get('language', 'ar') == 'ar' else 'Configure remote server connection' }}
                                            {% elif group_key == 'authentication' %}
                                                {{ 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù†' if session.get('language', 'ar') == 'ar' else 'Authentication and security credentials' }}
                                            {% elif group_key == 'auto_settings' %}
                                                {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ' if session.get('language', 'ar') == 'ar' else 'Automatic operation settings' }}
                                            {% elif group_key == 'mount_config' %}
                                                {{ 'ØªÙƒÙˆÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø¹ÙŠØ¯' if session.get('language', 'ar') == 'ar' else 'Configure remote storage mount points' }}
                                            {% elif group_key == 'mount_paths' %}
                                                {{ 'Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª' if session.get('language', 'ar') == 'ar' else 'Setup mount paths and folders' }}
                                            {% endif %}
                                        </small>
                                    </div>
                                    <div class="card-body" style="padding: 30px; background: rgba({{ group_color | replace('#', '') }}, 0.02);">
                                        {% for item in group_fields %}
                                            <div class="mb-4">
                                                <label for="{{ item.key }}" class="form-label" style="font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                                    {% if 'enabled' in item.key %}
                                                        <i data-feather="toggle-right" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'protocol' in item.key %}
                                                        <i data-feather="globe" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'host' in item.key %}
                                                        <i data-feather="server" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'port' in item.key %}
                                                        <i data-feather="link" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'username' in item.key %}
                                                        <i data-feather="user" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'password' in item.key %}
                                                        <i data-feather="lock" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'mount_point' in item.key %}
                                                        <i data-feather="target" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'remote_path' in item.key %}
                                                        <i data-feather="folder" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% elif 'auto' in item.key %}
                                                        <i data-feather="play-circle" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% else %}
                                                        <i data-feather="settings" style="width: 20px; height: 20px; color: {{ group_color }};"></i>
                                                    {% endif %}
                                                    <span style="font-size: 1.1em;">{{ item.translated_description }}</span>
                                                </label>
                                                
                                                {% if item.type == 'password' %}
                                                    <input type="password" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                           placeholder="******** ({{ t('leave_empty_no_change') }})"
                                                           style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ group_color }}20; font-size: 1.05em;">
                                                {% elif item.type == 'select' %}
                                                    <select class="form-control" id="{{ item.key }}" name="{{ item.key }}"
                                                            style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ group_color }}20; font-size: 1.05em;">
                                                        {% for option in item.option_list %}
                                                            <option value="{{ option.value }}" {% if item.value == option.value %}selected{% endif %}>
                                                                {{ option.label }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                {% elif (item.key.endswith('_path') or item.key.endswith('_mount') or item.key.endswith('_point') or item.key.endswith('_root')) and item.type != 'select' %}
                                                    <div class="input-group">
                                                        <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                               value="{{ item.value }}"
                                                               style="border-radius: 12px 0 0 12px; padding: 16px 20px; border: 2px solid {{ group_color }}20; font-size: 1.05em;">
                                                        <div class="input-group-append">
                                                            <button type="button" class="btn browse-btn" data-target="{{ item.key }}"
                                                                    style="background: {{ group_color }}; color: white; border: 2px solid {{ group_color }}; border-radius: 0 12px 12px 0; padding: 16px 20px; font-weight: 600;">
                                                                <i data-feather="folder" style="width: 20px; height: 20px;"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                           value="{{ item.value }}"
                                                           style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ group_color }}20; font-size: 1.05em;">
                                                {% endif %}
                                                
                                                {% if 'mount_point' in item.key %}
                                                    <small style="color: #666; margin-top: 8px; display: block; font-style: italic;">
                                                        {{ 'Ù…Ø«Ø§Ù„: /mnt/remote' if session.get('language', 'ar') == 'ar' else 'Example: /mnt/remote' }}
                                                    </small>
                                                {% elif 'remote_path' in item.key %}
                                                    <small style="color: #666; margin-top: 8px; display: block; font-style: italic;">
                                                        {{ 'Ù…Ø«Ø§Ù„: /volume1/data' if session.get('language', 'ar') == 'ar' else 'Example: /volume1/data' }}
                                                    </small>
                                                {% elif 'host' in item.key %}
                                                    <small style="color: #666; margin-top: 8px; display: block; font-style: italic;">
                                                        {{ 'Ù…Ø«Ø§Ù„: 192.168.1.100' if session.get('language', 'ar') == 'ar' else 'Example: 192.168.1.100' }}
                                                    </small>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <!-- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                    {% set section_colors = {
                        'DEFAULT': '#6c5ce7',
                        'API': '#00b894',
                        'MODELS': '#fd79a8',
                        'CORRECTIONS': '#fdcb6e',
                        'UI': '#74b9ff',
                        'PROCESSING': '#81ecec',
                        'MONITORING': '#fab1a0',
                        'FOOTER': '#a29bfe',
                        'LANGUAGE': '#55a3ff'
                    } %}
                    
                    {% set section_icons = {
                        'DEFAULT': 'settings',
                        'API': 'globe',
                        'MODELS': 'cpu',
                        'CORRECTIONS': 'edit-3',
                        'UI': 'layout',
                        'PROCESSING': 'zap',
                        'MONITORING': 'activity',
                        'FOOTER': 'info',
                        'LANGUAGE': 'type'
                    } %}
                    
                    {% set color = section_colors.get(section, '#6c5ce7') %}
                    {% set icon = section_icons.get(section, 'settings') %}
                    
                    <div class="card mb-4" style="background: var(--card-bg); border: 2px solid {{ color }}; border-radius: 16px; box-shadow: 0 4px 20px {{ color }}33;">
                        <div class="card-header text-center" style="background: linear-gradient(135deg, {{ color }}, {{ color }}); color: white; padding: 25px; border-radius: 14px 14px 0 0;">
                            <i data-feather="{{ icon }}" style="width: 32px; height: 32px; margin-bottom: 12px;"></i>
                            <h4 style="margin: 0; font-size: 1.3em; font-weight: 600;">
                                {% if section == 'DEFAULT' %}
                                    {{ 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©' if session.get('language', 'ar') == 'ar' else 'General Settings' }}
                                {% elif section == 'API' %}
                                    {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª' if session.get('language', 'ar') == 'ar' else 'API Services' }}
                                {% elif section == 'MODELS' %}
                                    {{ 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' if session.get('language', 'ar') == 'ar' else 'AI Models' }}
                                {% elif section == 'CORRECTIONS' %}
                                    {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­' if session.get('language', 'ar') == 'ar' else 'Corrections' }}
                                {% elif section == 'UI' %}
                                    {{ 'ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' if session.get('language', 'ar') == 'ar' else 'User Interface' }}
                                {% elif section == 'PROCESSING' %}
                                    {{ 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª' if session.get('language', 'ar') == 'ar' else 'File Processing' }}
                                {% elif section == 'MONITORING' %}
                                    {{ 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù…' if session.get('language', 'ar') == 'ar' else 'System Monitoring' }}
                                {% elif section == 'FOOTER' %}
                                    {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ°ÙŠÙŠÙ„' if session.get('language', 'ar') == 'ar' else 'Footer Settings' }}
                                {% elif section == 'LANGUAGE' %}
                                    {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„ØºØ©' if session.get('language', 'ar') == 'ar' else 'Language Settings' }}
                                {% else %}
                                    {{ section }}
                                {% endif %}
                            </h4>
                        </div>
                        <div class="card-body" style="padding: 30px; background: {{ color }}05;">
                            {% for item in items %}
                                <div class="mb-4">
                                    <label for="{{ item.key }}" class="form-label" style="font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 1.1em;">{{ item.translated_description }}</span>
                                        <small style="color: var(--text-secondary); font-weight: normal; font-size: 0.9em;">({{ item.key }})</small>
                                    </label>
                                    
                                    {% if item.key == 'ollama_model' %}
                                        <div style="margin-bottom: 10px; padding: 15px; border-radius: 8px; background: var(--bg-secondary); border-left: 4px solid var(--accent-warning);">
                                            <small style="color: var(--text-warning); display: block;">
                                                âš ï¸ {{ t('ollama_model_warning') }}: <code>ollama pull model_name</code>
                                            </small>
                                        </div>
                                    {% elif item.key == 'whisper_model' %}
                                        <div style="margin-bottom: 10px; padding: 15px; border-radius: 8px; background: var(--bg-secondary); border-left: 4px solid var(--accent-info);">
                                            <small style="color: var(--text-info); display: block;">
                                                â„¹ï¸ {{ t('whisper_model_info') }}
                                            </small>
                                        </div>
                                    {% elif item.key in ['whisper_model_gpu', 'ollama_model_gpu'] %}
                                        <div style="margin-bottom: 15px; padding: 15px; border-radius: 8px; background: var(--bg-secondary); border-left: 4px solid var(--accent-info);">
                                            <small style="color: var(--text-info); display: block;">
                                                â„¹ï¸ {{ 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹Ø·Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹' if session.get('language', 'ar') == 'ar' else 'GPU settings currently disabled' }}
                                            </small>
                                        </div>
                                    {% endif %}
                                    
                                    {% if item.type == 'password' %}
                                        <input type="password" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                               placeholder="******** ({{ t('leave_empty_no_change') }})"
                                               style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ color }}33; font-size: 1.05em;">
                                    {% elif item.type == 'select' %}
                                        <select class="form-control" id="{{ item.key }}" name="{{ item.key }}"
                                                style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ color }}33; font-size: 1.05em;">
                                            {% for option in item.option_list %}
                                                <option value="{{ option.value }}" {% if item.value == option.value %}selected{% endif %}>
                                                    {{ option.label }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% elif (item.key.endswith('_path') or item.key.endswith('_mount') or item.key.endswith('_point') or item.key.endswith('_root')) and item.type != 'select' %}
                                        <div class="input-group">
                                            <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                                   value="{{ item.value }}"
                                                   style="border-radius: 12px 0 0 12px; padding: 16px 20px; border: 2px solid {{ color }}33; font-size: 1.05em;">
                                            <div class="input-group-append">
                                                <button type="button" class="btn browse-btn" data-target="{{ item.key }}"
                                                        style="background: {{ color }}; color: white; border: 2px solid {{ color }}; border-radius: 0 12px 12px 0; padding: 16px 20px; font-weight: 600;">
                                                    <i data-feather="folder" style="width: 20px; height: 20px;"></i>
                                                </button>
                                            </div>
                                        </div>
                                    {% else %}
                                        <input type="{{ item.type }}" class="form-control" id="{{ item.key }}" name="{{ item.key }}" 
                                               value="{{ item.value }}"
                                               style="border-radius: 12px; padding: 16px 20px; border: 2px solid {{ color }}33; font-size: 1.05em;">
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                <button type="submit" class="action-btn btn-save">
                    <i data-feather="save"></i>
                    {{ t('save_settings') }} 
                    {% if section == 'DEFAULT' %}
                        {{ t('general_settings') }}
                    {% elif section == 'API' %}
                        {{ t('api_settings') }}
                    {% elif section == 'PATHS' %}
                        {{ t('path_settings') }}
                    {% elif section == 'MODELS' %}
                        {{ t('model_settings') }}
                    {% elif section == 'CORRECTIONS' %}
                        {{ t('correction_settings') }}
                    {% elif section == 'UI' %}
                        {{ t('interface_settings') }}
                    {% elif section == 'PROCESSING' %}
                        {{ t('processing_settings') }}
                    {% elif section == 'MONITORING' %}
                        {{ t('monitoring_settings') }}
                    {% elif section == 'FOOTER' %}
                        {{ t('footer_settings') }}
                    {% elif section == 'LANGUAGE' %}
                        {{ t('language_settings') }}
                    {% else %}
                        {{ section }}
                    {% endif %}
                </button>
            </div>
        </div>
        {% endfor %}
    </form>

    <!-- GPU Management Tab -->
    <div class="tab-content hidden" id="tab-gpu">
        <form method="post" action="{{ url_for('settings_page') }}">
            <div class="form-section">
                <h3>{{ t('gpu_management') }}</h3>
                <p>{{ t('gpu_management_info') }}</p>
                
                <div class="info-box" style="margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i data-feather="info" style="color: var(--accent-primary);"></i>
                        <strong>{{ t('note') }}:</strong>
                    </div>
                    <p style="margin: 0;">{{ t('gpu_real_system_detection') }}</p>
                </div>

                <div class="settings-grid">
                    {% for section, items in settings_by_section.items() %}
                        {% for item in items %}
                            {% if 'gpu' in item.key %}
                            <div class="setting-item">
                                <label for="{{ item.key }}">{{ item.translated_description }}</label>
                                {% if item.type == 'select' %}
                                    <select name="{{ item.key }}" id="{{ item.key }}">
                                        {% for option in item.option_list %}
                                            <option value="{{ option.value }}" 
                                                {% if option.value == item.value %}selected{% endif %}>
                                                {{ option.label }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                {% elif item.type == 'number' %}
                                    <input type="number" 
                                           name="{{ item.key }}" 
                                           id="{{ item.key }}" 
                                           value="{{ item.value }}" 
                                           min="0" 
                                           max="100" />
                                {% elif item.type == 'checkbox' %}
                                    <input type="checkbox" 
                                           name="{{ item.key }}" 
                                           id="{{ item.key }}" 
                                           {% if item.value == 'true' %}checked{% endif %} />
                                {% else %}
                                    <input type="{{ item.type }}" 
                                           name="{{ item.key }}" 
                                           id="{{ item.key }}" 
                                           value="{{ item.value }}" />
                                {% endif %}
                                {% if item.help %}
                                    <small class="help-text">{{ item.help }}</small>
                                {% endif %}
                            </div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </div>
                
                <div class="gpu-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">{{ t('gpu_control_panel') }}</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <button type="button" class="action-btn" onclick="refreshGPUOptions()">
                            <i data-feather="refresh-cw"></i>
                            {{ t('refresh_gpu_options') }}
                        </button>
                        <button type="button" class="action-btn secondary" onclick="smartGPUAllocation()">
                            <i data-feather="zap"></i>
                            {{ t('smart_allocation') }}
                        </button>
                        <button type="button" class="action-btn tertiary" onclick="showGPUDiagnosis()">
                            <i data-feather="activity"></i>
                            {{ t('gpu_diagnosis') }}
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="button-group">
                    <button type="submit" class="action-btn">
                        <i data-feather="save"></i>
                        {{ t('save_settings') }}
                    </button>
                    <button type="button" class="action-btn secondary" onclick="switchCategory('DEFAULT')">
                        <i data-feather="arrow-left"></i>
                        {{ t('back_to_general') }}
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Library Management Tab -->
    <div class="tab-content hidden" id="tab-library">
        <div class="form-section">
            <h3>{{ t('library_management') }}</h3>
            <p>{{ t('sync_library_description') }}</p>
            <form action="{{ url_for('action_sync_library') }}" method="post" style="display: inline;">
                <button type="submit" class="action-btn">
                    <i data-feather="refresh-cw"></i>
                    {{ t('sync_library') }}
                </button>
            </form>
        </div>
    </div>

    <!-- Database Administration Tab -->
    <div class="tab-content hidden" id="tab-database">
        <div class="form-section">
            <h3>{{ t('database_admin') }}</h3>
            
            <!-- Database Actions Grid -->
            <div class="database-actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <button class="action-btn database-action-btn" onclick="loadDatabaseStats()" data-action="stats">
                    <i data-feather="bar-chart-2"></i>
                    <span>{{ t('database_stats') }}</span>
                    <small>{{ t('view_database_statistics') }}</small>
                </button>
                <button class="action-btn database-action-btn" onclick="loadDatabaseTables()" data-action="tables">
                    <i data-feather="grid"></i>
                    <span>{{ t('view_tables') }}</span>
                    <small>{{ t('explore_database_structure') }}</small>
                </button>
                <button class="action-btn database-action-btn" onclick="showSqlConsole()" data-action="sql">
                    <i data-feather="terminal"></i>
                    <span>{{ t('sql_console') }}</span>
                    <small>{{ t('execute_custom_queries') }}</small>
                </button>
                <button class="action-btn database-action-btn" onclick="backupDatabase()" data-action="backup">
                    <i data-feather="download"></i>
                    <span>{{ t('backup_database') }}</span>
                    <small>{{ t('create_database_backup') }}</small>
                </button>
                <button class="action-btn database-action-btn" onclick="optimizeDatabase()" data-action="optimize">
                    <i data-feather="zap"></i>
                    <span>{{ t('optimize_database') }}</span>
                    <small>{{ t('improve_performance') }}</small>
                </button>
                <button class="action-btn database-action-btn" onclick="cleanupDatabase()" data-action="cleanup">
                    <i data-feather="trash-2"></i>
                    <span>{{ t('cleanup_data') }}</span>
                    <small>{{ t('remove_old_records') }}</small>
                </button>
            </div>
            
            <!-- Database Content Area -->
            <div id="database-content" class="database-content-area">
                <div class="welcome-message">
                    <i data-feather="database" style="font-size: 3rem; color: var(--accent-primary); margin-bottom: 1rem;"></i>
                    <h4>{{ t('database_management') }}</h4>
                    <p>{{ t('select_action_to_start') }}</p>
                </div>
            </div>
        </div>
        

    <!-- Development Tools Tab -->
    <div class="tab-content hidden" id="tab-DEVELOPMENT">
        <div class="form-section">
            <h3 style="color: var(--accent-primary); display: flex; align-items: center; gap: 10px;">
                <i data-feather="code"></i> {{ t('development_tools') }}
            </h3>
            
            <!-- Warning Section -->
            <div class="help-section" style="background: var(--accent-warning-bg, rgba(245, 158, 11, 0.1)); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-warning);">
                <h4 style="display: flex; align-items: center; gap: 8px; color: var(--accent-warning); margin-bottom: 15px;">
                    <i data-feather="alert-triangle"></i> {{ t('development_mode_warning') }}
                </h4>
                <p style="color: var(--text-secondary); margin: 0;">
                    {{ t('development_mode_description') }}
                </p>
            </div>

            <!-- Development Settings Form -->
            <form method="post" action="{{ url_for('settings_page') }}">
                {% for item in settings_by_section.get('DEVELOPMENT', []) %}
                <div class="form-group">
                    <label for="{{ item.key }}">
                        {{ item.translated_description }}
                        <small style="color: var(--text-secondary); font-weight: normal;">({{ item.key }})</small>
                    </label>
                    {% if item.type == 'select' %}
                        <select id="{{ item.key }}" name="{{ item.key }}">
                            {% if item.options %}
                                {% for option_pair in item.options.split(',') %}
                                    {% if ':' in option_pair %}
                                        {% set opt_val, opt_label = option_pair.split(':', 1) %}
                                        <option value="{{ opt_val }}" {% if item.value == opt_val %}selected{% endif %}>
                                            {{ opt_label }}
                                        </option>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <option value="false" {% if item.value == 'false' %}selected{% endif %}>{{ t('disabled') }}</option>
                                <option value="true" {% if item.value == 'true' %}selected{% endif %}>{{ t('enabled') }}</option>
                            {% endif %}
                        </select>
                    {% else %}
                        <input type="{{ item.type }}" id="{{ item.key }}" name="{{ item.key }}" value="{{ item.value }}">
                    {% endif %}
                </div>
                {% endfor %}
                
                <button type="submit" class="action-btn btn-save">
                    <i data-feather="save"></i>
                    {{ t('save_development_settings') }}
                </button>
            </form>

            <!-- Development Status Display -->
            <div id="development-status" class="status-display" style="margin-top: 20px; padding: 15px; background: var(--bg-success); border-radius: 8px; border-left: 4px solid var(--accent-success);">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i data-feather="check-circle" style="color: var(--accent-success);"></i>
                    <span style="color: var(--text-success); font-weight: 500;">{{ t('development_tools_ready') }}</span>
                </div>
            </div>

            <!-- Development Actions -->
            <div style="margin-top: 30px; padding: 20px; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color);">
                <h4 style="color: var(--accent-info); margin-bottom: 15px;">
                    <i data-feather="tool"></i> {{ t('development_actions') }}
                </h4>
                
                <div class="database-actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <!-- Sample Data Creation -->
                    <div class="action-group" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <h5 style="color: var(--accent-primary); margin-bottom: 10px;">{{ t('sample_data_management') }}</h5>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <button class="action-btn btn-info" onclick="createSampleTranslationLogs()" style="font-size: 0.9em;">
                                <i data-feather="file-plus"></i>
                                {{ t('create_sample_translation_logs') }}
                            </button>
                            <button class="action-btn btn-info" onclick="createSampleMediaFiles()" style="font-size: 0.9em;">
                                <i data-feather="film"></i>
                                {{ t('create_sample_media_files') }}
                            </button>
                            <button class="action-btn btn-info" onclick="createSampleBlacklist()" style="font-size: 0.9em;">
                                <i data-feather="x-circle"></i>
                                {{ t('create_sample_blacklist') }}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Data Cleanup -->
                    <div class="action-group" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <h5 style="color: var(--accent-warning); margin-bottom: 10px;">{{ t('data_cleanup') }}</h5>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <button class="action-btn btn-warning" onclick="clearSampleMediaFiles()" style="font-size: 0.9em;">
                                <i data-feather="trash-2"></i>
                                {{ t('clear_sample_media_files') }}
                            </button>
                            <button class="action-btn btn-warning" onclick="clearSampleBlacklist()" style="font-size: 0.9em;">
                                <i data-feather="x"></i>
                                {{ t('clear_sample_blacklist') }}
                            </button>
                            <button class="action-btn btn-warning" onclick="clearSampleTranslationLogs()" style="font-size: 0.9em;">
                                <i data-feather="file-text"></i>
                                {{ t('clear_sample_translation_logs') }}
                            </button>
                            <button class="action-btn btn-danger" onclick="clearAllSampleData()" style="font-size: 0.9em;">
                                <i data-feather="delete"></i>
                                {{ t('clear_all_sample_data') }}
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Development Status -->
                <div id="development-status" style="margin-top: 15px; padding: 10px; background: var(--bg-primary); border-radius: 4px; font-family: monospace; font-size: 0.9em; min-height: 40px;">
                    {{ t('development_tools_ready') }}
                </div>
            </div>
        </div>
    </div>

    </div>
</div>
{% endblock %}

{% block head_extra %}
<style>
.settings-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.database-action-btn {
    flex-direction: column;
    text-align: center;
    padding: 1.5rem 1rem;
    min-height: 120px;
    position: relative;
}

.database-action-btn i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: var(--accent-primary);
}

.database-action-btn span {
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.database-action-btn small {
    font-size: 0.8rem;
    color: var(--text-secondary);
    opacity: 0.8;
}

.database-content-area {
    background-color: var(--bg-secondary);
    padding: 2rem;
    border-radius: 8px;
    min-height: 400px;
    border: 1px solid var(--border-color);
}

.welcome-message {
    text-align: center;
    padding: 2rem;
}

.welcome-message i {
    display: block;
    margin: 0 auto 1rem;
}

.welcome-message h4 {
    margin: 0 0 1rem 0;
    color: var(--text-primary);
}

.welcome-message p {
    color: var(--text-secondary);
    margin: 0;
}

.sql-console {
    direction: rtl;
    text-align: right;
}

.sql-console h4 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: var(--accent-primary);
}

.sql-input-area {
    margin-bottom: 1.5rem;
}

.sql-actions {
    direction: rtl;
}

/* Log Styles */
.log-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    align-items: center;
}

.log-container {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    max-height: 500px;
    min-height: 300px;
    overflow-y: auto;
    margin-top: 1rem;
    width: 100%;
}

.log-content {
    padding: 1rem;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.6;
    direction: ltr;
    text-align: left;
    min-height: 260px;
    width: 100%;
    box-sizing: border-box;
}

.log-entry {
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    border-radius: 4px;
    border-left: 3px solid var(--border-color);
}

.log-entry.error {
    background: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
    color: #ef4444;
}

.log-entry.warning {
    background: rgba(245, 158, 11, 0.1);
    border-left-color: #f59e0b;
    color: #f59e0b;
}

.log-entry.info {
    background: rgba(59, 130, 246, 0.1);
    border-left-color: #3b82f6;
    color: #3b82f6;
}

.log-timestamp {
    font-weight: bold;
    margin-left: 0.5rem;
}

.log-level {
    font-weight: bold;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.8rem;
    margin-left: 0.5rem;
}

.log-message {
    margin-top: 0.25rem;
}

.loading-message, .empty-message, .error-message {
    text-align: center;
    padding: 2rem;
    color: var(--text-secondary);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
}

.success-message {
    text-align: center;
    padding: 2rem;
    color: var(--accent-green);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
}

.loading-message .spinner {
    animation: spin 1s linear infinite;
    margin-bottom: 0.5rem;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.form-section h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.form-section h3:before {
    content: '';
    width: 4px;
    height: 1.5rem;
    background: var(--accent-primary);
    border-radius: 2px;
}

/* Settings Navigation Styles */
.settings-navigation {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.navigation-header h3 {
    margin-bottom: 15px;
    color: var(--text-primary);
}

.category-dropdown-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.dropdown-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.dropdown-label {
    font-weight: bold;
    color: var(--text-primary);
    font-size: 0.9em;
}

.category-select,
.subcategory-select {
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background: var(--input-bg);
    color: var(--text-primary);
    font-size: 1em;
    transition: all 0.3s ease;
}

.category-select:hover,
.subcategory-select:hover {
    border-color: var(--accent-primary);
}

.category-select:focus,
.subcategory-select:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

/* Dropdown options styling */
.category-select option,
.subcategory-select option {
    background: var(--input-bg);
    color: var(--text-primary);
    padding: 8px 12px;
}

/* Ensure proper styling for all select elements in settings */
select {
    background: var(--input-bg) !important;
    color: var(--text-primary) !important;
    border: 1px solid var(--border-color) !important;
}

select option {
    background: var(--input-bg) !important;
    color: var(--text-primary) !important;
}

@media (max-width: 768px) {
    .settings-actions {
        flex-direction: column;
        width: 100%;
    }
    
    .database-actions-grid {
        grid-template-columns: 1fr !important;
    }
    
    .database-action-btn {
        min-height: 80px;
    }
    
    .category-dropdown-container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}
</style>
{% endblock %}

<!-- File Browser Modal -->
{% include 'file-browser-modal.html' %}

{% block scripts %}
<script>
    // Get current language
    const currentLang = document.documentElement.getAttribute('lang') || 'ar';
    
    // Initialize with current language - will be updated dynamically
    let settingsCategories = {};

    let currentCategory = 'general';
    let currentSubcategory = 'DEFAULT';

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize navigation after a short delay to ensure elements are ready
        setTimeout(function() {
            // Refresh dropdown translations first
            refreshSettingsDropdowns();
            initializeSettingsNavigation();
            // Initialize first tab
            switchToTab('DEFAULT');
            // Load current server info
            loadCurrentServerInfo();
            // Update form dropdowns after page load
            updateFormDropdowns();
            // Update tab titles after page load
            updateTabTitles();
        }, 100);
    });

    // Load current server information
    function loadCurrentServerInfo() {
        fetch('/api/server-config/status')
            .then(response => response.json())
            .then(data => {
                if (data.current_config) {
                    const hostDisplay = document.getElementById('current-host-display');
                    const portDisplay = document.getElementById('current-port-display');
                    
                    if (hostDisplay) {
                        // Show actual host if available, otherwise saved host
                        const displayHost = data.current_config.actual_host || data.current_config.host || '0.0.0.0';
                        hostDisplay.textContent = displayHost;
                        
                        // Update the server_host input field if it exists and is empty or default
                        const hostInput = document.querySelector('input[name="server_host"]');
                        if (hostInput) {
                            if (!hostInput.value || hostInput.value === '0.0.0.0') {
                                hostInput.value = displayHost;
                            }
                        }
                    }
                    
                    if (portDisplay) {
                        const port = data.current_config.port || 5000;
                        portDisplay.textContent = port;
                        
                        // Update the server_port input field if it exists
                        const portInput = document.querySelector('input[name="server_port"]');
                        if (portInput) {
                            if (!portInput.value || portInput.value === '5000') {
                                portInput.value = port;
                            }
                        }
                    }
                }
            })
            .catch(error => {
                console.log('Server config status not available:', error);
                // Set fallback values using current browser info
                const hostDisplay = document.getElementById('current-host-display');
                const portDisplay = document.getElementById('current-port-display');
                
                const currentHost = window.location.hostname || '0.0.0.0';
                const currentPort = window.location.port || '5000';
                
                if (hostDisplay) hostDisplay.textContent = currentHost;
                if (portDisplay) portDisplay.textContent = currentPort;
                
                // Update input fields with current browser values
                const hostInput = document.querySelector('input[name="server_host"]');
                const portInput = document.querySelector('input[name="server_port"]');
                
                if (hostInput && (!hostInput.value || hostInput.value === '0.0.0.0')) {
                    hostInput.value = currentHost;
                }
                if (portInput && (!portInput.value || portInput.value === '5000')) {
                    portInput.value = currentPort;
                }
            });
    }

    function initializeSettingsNavigation() {
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        
        if (!categorySelect || !subcategorySelect) return;
        
        // Populate category dropdown with current categories
        const currentCategories = window.settingsCategories || settingsCategories;
        categorySelect.innerHTML = '';
        Object.keys(currentCategories).forEach(categoryKey => {
            const option = document.createElement('option');
            option.value = categoryKey;
            option.textContent = currentCategories[categoryKey].name;
            categorySelect.appendChild(option);
        });
        
    }

    window.switchCategory = function() {
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        
        if (!categorySelect || !subcategorySelect) return;
        
        // Use categorySelect.value directly and current categories
        const currentCategories = window.settingsCategories || settingsCategories;
        const category = currentCategories[categorySelect.value];
        
        if (!category) return;
        
        // Clear and populate subcategory dropdown
        subcategorySelect.innerHTML = '';
        Object.keys(category.subcategories).forEach(subKey => {
            const option = document.createElement('option');
            option.value = subKey;
            option.textContent = category.subcategories[subKey];
            subcategorySelect.appendChild(option);
        });
        
        // Set first subcategory as default
        const firstSubcategory = Object.keys(category.subcategories)[0];
        if (firstSubcategory) {
            subcategorySelect.value = firstSubcategory;
            // Don't reassign const variable - use firstSubcategory directly
            
            // Switch to the first tab in this category
            switchToTab(firstSubcategory);
        }
    };

    // Function to refresh dropdown options with current language
    window.refreshSettingsDropdowns = function() {
        const currentLang = document.documentElement.getAttribute('lang') || 'ar';
        
        // Update all settings categories with correct language
        const updatedSettingsCategories = {
            general: {
                name: currentLang === 'ar' ? "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©" : "General Settings",
                subcategories: {
                    'DEFAULT': currentLang === 'ar' ? 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' : 'Basic Settings',
                    'LANGUAGE': currentLang === 'ar' ? 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„ØºØ©' : 'Language Settings',
                    'FOOTER': currentLang === 'ar' ? 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ°ÙŠÙŠÙ„' : 'Footer Settings'
                }
            },
            ai: {
                name: currentLang === 'ar' ? "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ" : "AI Services",
                subcategories: {
                    'MODELS': currentLang === 'ar' ? 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'AI Models',
                    'API': currentLang === 'ar' ? 'Ø®Ø¯Ù…Ø© Ollama' : 'Ollama Service',
                    'gpu': currentLang === 'ar' ? 'Ø¥Ø¯Ø§Ø±Ø© ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©' : 'GPU Management'
                }
            },
            media: {
                name: currentLang === 'ar' ? "Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ÙˆØ³Ø§Ø¦Ø·" : "Media Servers",
                subcategories: {
                    'PLEX': currentLang === 'ar' ? 'Ø®Ø§Ø¯Ù… Plex' : 'Plex Server',
                    'JELLYFIN': currentLang === 'ar' ? 'Ø®Ø§Ø¯Ù… Jellyfin' : 'Jellyfin Server',
                    'EMBY': currentLang === 'ar' ? 'Ø®Ø§Ø¯Ù… Emby' : 'Emby Server',
                    'KODI': currentLang === 'ar' ? 'Ù…Ø±ÙƒØ² ÙˆØ³Ø§Ø¦Ø· Kodi' : 'Kodi Media Center',
                    'RADARR': currentLang === 'ar' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø£ÙÙ„Ø§Ù… Radarr' : 'Radarr Movies',
                    'SONARR': currentLang === 'ar' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Sonarr' : 'Sonarr TV Shows'
                }
            },
            storage: {
                name: currentLang === 'ar' ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†" : "Storage Management",
                subcategories: {
                    'REMOTE_STORAGE': currentLang === 'ar' ? 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø¹ÙŠØ¯' : 'Remote Storage',
                    'PATHS': currentLang === 'ar' ? 'Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª' : 'File Paths'
                }
            },
            system: {
                name: currentLang === 'ar' ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…" : "System Management",
                subcategories: {
                    'SERVER': currentLang === 'ar' ? 'ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Ø¯Ù…' : 'Server Configuration',
                    'CORRECTIONS': currentLang === 'ar' ? 'ØªØµØ­ÙŠØ­ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª' : 'Translation Corrections',
                    'library': currentLang === 'ar' ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø©' : 'Library Management',
                    'database': currentLang === 'ar' ? 'Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' : 'Database Admin'
                }
            },
            development: {
                name: currentLang === 'ar' ? "Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±" : "Development Tools",
                subcategories: {
                    'DEVELOPMENT': currentLang === 'ar' ? 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±' : 'Development Tools'
                }
            }
        };
        
        // Use the updated categories for refresh
        settingsCategories = updatedSettingsCategories;
        window.settingsCategories = updatedSettingsCategories;
        
        // Refresh the dropdowns
        initializeSettingsNavigation();
        if (window.switchCategory) {
            window.switchCategory();
        }
        
        // Update form dropdowns too
        updateFormDropdowns();
        
        // Update tab titles too
        updateTabTitles();
    };

    // Function to update tab titles based on current language
    function updateTabTitles() {
        const currentLang = document.documentElement.getAttribute('lang') || 'ar';
        
        // Update development tools tab title
        const developmentTitle = document.querySelector('#tab-DEVELOPMENT h3');
        if (developmentTitle) {
            const icon = developmentTitle.querySelector('i');
            const iconHTML = icon ? icon.outerHTML : '<i data-feather="code"></i>';
            const titleText = currentLang === 'ar' ? 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±' : 'Development Tools';
            developmentTitle.innerHTML = `${iconHTML} ${titleText}`;
        }
        
        // Update other tab titles if needed
        const generalTitle = document.querySelector('#tab-DEFAULT h3');
        if (generalTitle) {
            const icon = generalTitle.querySelector('i');
            const iconHTML = icon ? icon.outerHTML : '<i data-feather="settings"></i>';
            const titleText = currentLang === 'ar' ? 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©' : 'Basic Settings';
            generalTitle.innerHTML = `${iconHTML} ${titleText}`;
        }
        
        // Refresh feather icons after updating
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    }

    // Function to update form dropdown options based on current language
    function updateFormDropdowns() {
        const currentLang = document.documentElement.getAttribute('lang') || 'ar';
        
        // Define dropdown options for different languages
        const dropdownOptions = {
            'default_language': {
                'ar': {'ar': 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'en': 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'},
                'en': {'ar': 'Arabic', 'en': 'English'}
            },
            'default_theme': {
                'ar': {'dark': 'Ø¯Ø§ÙƒÙ†', 'light': 'ÙØ§ØªØ­', 'system': 'ØªÙ„Ù‚Ø§Ø¦ÙŠ'},
                'en': {'dark': 'Dark', 'light': 'Light', 'system': 'Auto'}
            },
            'items_per_page': {
                'ar': {'12': '12', '24': '24', '48': '48', '96': '96'},
                'en': {'12': '12', '24': '24', '48': '48', '96': '96'}
            },
            'whisper_model': {
                'ar': {
                    'tiny.en': 'ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹',
                    'base.en': 'Ø£Ø³Ø§Ø³ÙŠ', 
                    'small.en': 'ØµØºÙŠØ±',
                    'medium.en': 'Ù…ØªÙˆØ³Ø·',
                    'large': 'ÙƒØ¨ÙŠØ±'
                },
                'en': {
                    'tiny.en': 'Tiny',
                    'base.en': 'Base',
                    'small.en': 'Small', 
                    'medium.en': 'Medium',
                    'large': 'Large'
                }
            },
            'ollama_model': {
                'ar': {
                    'llama3': 'Llama 3',
                    'llama3.1': 'Llama 3.1',
                    'mistral': 'Mistral',
                    'codellama': 'Code Llama'
                },
                'en': {
                    'llama3': 'Llama 3',
                    'llama3.1': 'Llama 3.1',
                    'mistral': 'Mistral',
                    'codellama': 'Code Llama'
                }
            },
            'whisper_model_gpu': {
                'ar': {'auto': 'ØªÙ„Ù‚Ø§Ø¦ÙŠ', '0': 'GPU 0', '1': 'GPU 1', 'cpu': 'Ù…Ø¹Ø§Ù„Ø¬ ÙÙ‚Ø·'},
                'en': {'auto': 'Auto', '0': 'GPU 0', '1': 'GPU 1', 'cpu': 'CPU Only'}
            },
            'ollama_model_gpu': {
                'ar': {'auto': 'ØªÙ„Ù‚Ø§Ø¦ÙŠ', '0': 'GPU 0', '1': 'GPU 1', 'cpu': 'Ù…Ø¹Ø§Ù„Ø¬ ÙÙ‚Ø·'},
                'en': {'auto': 'Auto', '0': 'GPU 0', '1': 'GPU 1', 'cpu': 'CPU Only'}
            },
            'debug_mode': {
                'ar': {'true': 'Ù…ÙØ¹Ù„', 'false': 'Ù…Ø¹Ø·Ù„'},
                'en': {'true': 'Enabled', 'false': 'Disabled'}
            },
            'enable_testing_features': {
                'ar': {'true': 'Ù…ÙØ¹Ù„', 'false': 'Ù…Ø¹Ø·Ù„'},
                'en': {'true': 'Enabled', 'false': 'Disabled'}
            },
            'log_level': {
                'ar': {
                    'DEBUG': 'ØªØ´Ø®ÙŠØµ',
                    'INFO': 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
                    'WARNING': 'ØªØ­Ø°ÙŠØ±',
                    'ERROR': 'Ø®Ø·Ø£'
                },
                'en': {
                    'DEBUG': 'Debug',
                    'INFO': 'Info',
                    'WARNING': 'Warning',
                    'ERROR': 'Error'
                }
            }
        };
        
        // Update each dropdown
        Object.keys(dropdownOptions).forEach(selectName => {
            const selectElement = document.getElementById(selectName);
            if (selectElement && dropdownOptions[selectName][currentLang]) {
                const currentValue = selectElement.value;
                const options = dropdownOptions[selectName][currentLang];
                
                // Clear existing options
                selectElement.innerHTML = '';
                
                // Add new options with correct language
                Object.keys(options).forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = options[value];
                    if (value === currentValue) {
                        option.selected = true;
                    }
                    selectElement.appendChild(option);
                });
            }
        });
    }

    // Save current selection to sessionStorage
    window.saveCurrentSelection = function() {
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        
        if (categorySelect && subcategorySelect) {
            sessionStorage.setItem('selectedCategory', categorySelect.value);
            sessionStorage.setItem('selectedSubcategory', subcategorySelect.value);
        }
    };
    
    // Restore selection from sessionStorage
    window.restoreSelection = function() {
        const savedCategory = sessionStorage.getItem('selectedCategory');
        const savedSubcategory = sessionStorage.getItem('selectedSubcategory');
        
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        
        if (savedCategory && categorySelect) {
            categorySelect.value = savedCategory;
            if (window.switchCategory) {
                window.switchCategory();
            }
            
            if (savedSubcategory && subcategorySelect) {
                setTimeout(function() {
                    subcategorySelect.value = savedSubcategory;
                    // Don't reassign const variable - it's set automatically
                    switchToTab(savedSubcategory);
                }, 50);
            }
        }
    };

    // Initialize categories after definition
    document.addEventListener('DOMContentLoaded', function() {
        // Set initial category and populate subcategories  
        setTimeout(function() {
            refreshSettingsDropdowns();
            // Try to restore previous selection
            setTimeout(restoreSelection, 150);
        }, 100);
        
        // Save selection when changing categories/subcategories
        document.addEventListener('change', function(e) {
            if (e.target.id === 'category-select' || e.target.id === 'subcategory-select') {
                saveCurrentSelection();
            }
        });
    });

    window.switchTab = function() {
        const subcategorySelect = document.getElementById('subcategory-select');
        if (!subcategorySelect) return;
        
        currentSubcategory = subcategorySelect.value;
        switchToTab(currentSubcategory);
    };

    function switchToTab(tabId) {
        // Hide all tab contents
        const contents = document.querySelectorAll('.tab-content');
        contents.forEach(content => {
            content.classList.add('hidden');
        });
        
        // Show selected tab
        const targetTab = document.getElementById(`tab-${tabId}`);
        if (targetTab) {
            targetTab.classList.remove('hidden');
            
            // If it's the GPU tab, refresh GPU info
            if (tabId === 'gpu' && typeof refreshGPUInfo === 'function') {
                setTimeout(refreshGPUInfo, 100);
            }
        }
    }

    // Optimized tab system for better performance
    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.tab-link');
        const contents = document.querySelectorAll('.tab-content');
        
        // Use event delegation for better performance
        document.querySelector('.tab-nav')?.addEventListener('click', function(e) {
            const tab = e.target.closest('.tab-link');
            if (!tab) return;
            
            // Use requestAnimationFrame for smooth transitions
            requestAnimationFrame(() => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.add('hidden'));
                tab.classList.add('active');
                const targetTab = document.getElementById(`tab-${tab.dataset.tab}`);
                if (targetTab) {
                    targetTab.classList.remove('hidden');
                }
            });
        });

        // Database management functions
        function showDatabaseLoading() {
            const content = document.getElementById('database-content');
            if (content) {
                content.innerHTML = `
                    <div class="loading-message">
                        <i data-feather="loader" class="spinner"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                    </div>
                `;
                feather.replace();
            }
        }

        function showDatabaseError(message) {
            const content = document.getElementById('database-content');
            if (content) {
                content.innerHTML = `
                    <div class="error-message">
                        <i data-feather="alert-circle"></i>
                        <p>${message}</p>
                    </div>
                `;
                feather.replace();
            }
        }

        function showDatabaseSuccess(message) {
            const content = document.getElementById('database-content');
            if (content) {
                content.innerHTML = `
                    <div class="success-message">
                        <i data-feather="check-circle"></i>
                        <p>${message}</p>
                    </div>
                `;
                feather.replace();
            }
        }

        window.loadDatabaseStats = function() {
            showDatabaseLoading();
            
            fetch('/api/database/stats', {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                
                if (data.error) {
                    showDatabaseError(`Ø®Ø·Ø£: ${data.error}`);
                    return;
                }
                
                let html = `
                    <div class="database-stats-container">
                        <div class="stats-header">
                            <h4><i data-feather="bar-chart-2"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                        </div>
                        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="stat-card" style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                                <i data-feather="hard-drive" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                <h5 style="margin: 0 0 0.5rem 0; color: var(--text-secondary);">Ø­Ø¬Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h5>
                                <p class="stat-value" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary); margin: 0;">${data.total_size_mb} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>
                            </div>
                            <div class="stat-card" style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                                <i data-feather="grid" style="font-size: 2rem; color: var(--accent-green); margin-bottom: 0.5rem;"></i>
                                <h5 style="margin: 0 0 0.5rem 0; color: var(--text-secondary);">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h5>
                                <p class="stat-value" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-green); margin: 0;">${data.table_count}</p>
                            </div>
                            <div class="stat-card" style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                                <i data-feather="layers" style="font-size: 2rem; color: var(--accent-yellow); margin-bottom: 0.5rem;"></i>
                                <h5 style="margin: 0 0 0.5rem 0; color: var(--text-secondary);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h5>
                                <p class="stat-value" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-yellow); margin: 0;">${data.total_records.toLocaleString()}</p>
                            </div>
                            <div class="stat-card" style="background: var(--bg-primary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                                <i data-feather="download" style="font-size: 2rem; color: var(--accent-purple); margin-bottom: 0.5rem;"></i>
                                <h5 style="margin: 0 0 0.5rem 0; color: var(--text-secondary);">Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h5>
                                <p class="stat-value" style="font-size: 1rem; font-weight: bold; color: var(--accent-purple); margin: 0;">${data.last_backup}</p>
                            </div>
                        </div>
                `;
                
                // Add tables breakdown if available
                if (data.tables && data.tables.length > 0) {
                    html += `
                        <div class="tables-breakdown">
                            <h5 style="margin-bottom: 1rem; color: var(--text-primary);">ØªÙØµÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„:</h5>
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                                    <thead>
                                        <tr style="background: var(--bg-secondary);">
                                            <th style="padding: 0.75rem; border: 1px solid var(--border-color); text-align: right;">Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„</th>
                                            <th style="padding: 0.75rem; border: 1px solid var(--border-color); text-align: center;">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                    
                    data.tables.forEach(table => {
                        html += `
                            <tr>
                                <td style="padding: 0.75rem; border: 1px solid var(--border-color);">${table.name}</td>
                                <td style="padding: 0.75rem; border: 1px solid var(--border-color); text-align: center;">${table.record_count.toLocaleString()}</td>
                            </tr>`;
                    });
                    
                    html += `</tbody></table></div></div>`;
                }
                
                html += `</div>`;
                
                document.getElementById('database-content').innerHTML = html;
                feather.replace();
            })
            .catch(error => {
                showDatabaseError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
            });
        };

        window.loadDatabaseTables = function() {
            showDatabaseLoading();
            
            fetch('/api/database/tables', {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                
                if (data.error) {
                    showDatabaseError(`Ø®Ø·Ø£: ${data.error}`);
                    return;
                }
                
                let html = `
                    <div class="database-tables-container">
                        <div class="stats-header">
                            <h4><i data-feather="grid"></i> Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                                <thead>
                                    <tr style="background: var(--bg-secondary);">
                                        <th style="padding: 1rem; border: 1px solid var(--border-color); text-align: right; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„</th>
                                        <th style="padding: 1rem; border: 1px solid var(--border-color); text-align: right; font-weight: bold;">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶</th>
                                        <th style="padding: 1rem; border: 1px solid var(--border-color); text-align: center; font-weight: bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</th>
                                        <th style="padding: 1rem; border: 1px solid var(--border-color); text-align: center; font-weight: bold;">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù‚Ø¯Ø± (Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)</th>
                                        <th style="padding: 1rem; border: 1px solid var(--border-color); text-align: center; font-weight: bold;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                
                data.forEach(table => {
                    html += `
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); font-family: monospace; direction: ltr; text-align: left;">${table.name}</td>
                            <td style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); font-weight: 500;">${table.display_name || table.name}</td>
                            <td style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); text-align: center; color: var(--accent-primary); font-weight: bold;">${table.record_count.toLocaleString()}</td>
                            <td style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); text-align: center; color: var(--accent-green);">${table.size_mb}</td>
                            <td style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); text-align: center; color: var(--text-secondary); font-size: 0.85rem;">${table.last_updated}</td>
                        </tr>`;
                });
                
                html += `</tbody></table></div>
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border-color);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <i data-feather="info" style="width: 16px; height: 16px; margin-left: 0.5rem;"></i>
                            ØªÙ… Ø¹Ø±Ø¶ ${data.length} Ø¬Ø¯ÙˆÙ„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </p>
                    </div>
                </div>`;
                
                document.getElementById('database-content').innerHTML = html;
                feather.replace();
            })
            .catch(error => {
                showDatabaseError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„');
            });
        };

        window.backupDatabase = function() {
            fetch('/api/database/backup', { 
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    alert('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + data.error);
                }
            })
            .catch(error => {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            });
        };

        window.optimizeDatabase = function() {
            showDatabaseLoading();
            
            fetch('/api/database/optimize', { 
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showDatabaseSuccess('ØªÙ… ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    showDatabaseError('ÙØ´Ù„ ÙÙŠ ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + data.error);
                }
            })
            .catch(error => {
                showDatabaseError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            });
        };

        window.cleanupDatabase = function() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                return;
            }
            
            showDatabaseLoading();
            
            fetch('/api/database/cleanup', { 
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showDatabaseSuccess(`ØªÙ… ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. ØªÙ… Ø­Ø°Ù ${data.cleaned_records} Ø³Ø¬Ù„`);
                } else {
                    showDatabaseError('ÙØ´Ù„ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + data.error);
                }
            })
            .catch(error => {
                showDatabaseError('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            });
        };

        window.showSqlConsole = function() {
            const content = document.getElementById('database-content');
            content.innerHTML = `
                <div class="sql-console">
                    <h4>ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… SQL</h4>
                    <div class="sql-input-area">
                        <textarea id="sql-query" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³ØªØ¹Ù„Ø§Ù… SQL Ù‡Ù†Ø§..." rows="8" style="width: 100%; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 4px; padding: 1rem; font-family: monospace; direction: ltr; text-align: left;"></textarea>
                        <div class="sql-actions" style="margin-top: 1rem; display: flex; gap: 1rem;">
                            <button class="action-btn" onclick="executeSqlQuery()" style="background-color: var(--accent-primary);">
                                <i data-feather="play"></i>
                                ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
                            </button>
                            <button class="action-btn" onclick="clearSqlQuery()" style="background-color: var(--accent-yellow); color: var(--bg-dark);">
                                <i data-feather="x"></i>
                                Ù…Ø³Ø­
                            </button>
                        </div>
                    </div>
                    <div id="sql-results" style="margin-top: 2rem; background: var(--bg-primary); padding: 1rem; border-radius: 4px; min-height: 200px;">
                        <p style="color: var(--text-secondary);">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
                    </div>
                </div>
            `;
            feather.replace();
        };

        window.executeSqlQuery = function() {
            const query = document.getElementById('sql-query').value.trim();
            const resultsDiv = document.getElementById('sql-results');
            
            if (!query) {
                resultsDiv.innerHTML = '<p style="color: var(--accent-red);">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³ØªØ¹Ù„Ø§Ù… SQL</p>';
                return;
            }
            
            resultsDiv.innerHTML = '<div style="text-align: center;"><div class="spinner"></div></div>';
            
            fetch('/api/database/query', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                
                if (data.error) {
                    resultsDiv.innerHTML = `<p style="color: var(--accent-danger);">Ø®Ø·Ø£: ${data.error}</p>`;
                    return;
                }
                
                if (data.results && data.results.length > 0) {
                    let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">';
                    
                    // Headers
                    if (data.results[0]) {
                        html += '<thead><tr style="background: var(--bg-secondary);">';
                        Object.keys(data.results[0]).forEach(key => {
                            html += `<th style="padding: 0.75rem; border: 1px solid var(--border-color); text-align: right;">${key}</th>`;
                        });
                        html += '</tr></thead>';
                    }
                    
                    // Rows
                    html += '<tbody>';
                    data.results.forEach(row => {
                        html += '<tr>';
                        Object.values(row).forEach(value => {
                            html += `<td style="padding: 0.75rem; border: 1px solid var(--border-color);">${value || ''}</td>`;
                        });
                        html += '</tr>';
                    });
                    html += '</tbody></table></div>';
                    
                    html += `<p style="margin-top: 1rem; color: var(--text-secondary);">Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${data.results.length}</p>`;
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p style="color: var(--accent-success);">ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­ (Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¹Ø±Ø¶)</p>';
                }
            })
            .catch(error => {
                resultsDiv.innerHTML = `<p style="color: var(--accent-danger);">Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…: ${error.message}</p>`;
            });
        };

        window.clearSqlQuery = function() {
            document.getElementById('sql-query').value = '';
            document.getElementById('sql-results').innerHTML = '<p style="color: var(--text-secondary);">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>';
        };

        // Settings save functionality
        window.saveAllSettings = function() {
            const form = document.querySelector('form');
            if (!form) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
                return;
            }
            
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    location.reload();
                } else {
                    alert('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                }
            })
            .catch(error => {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message);
            });
        };

        // SQL query execution is already defined above - no need for duplication

        window.clearSqlQuery = function() {
            document.getElementById('sql-query').value = '';
            document.getElementById('sql-results').innerHTML = '<p style="color: var(--text-secondary);">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>';
        };

        // Helper functions for database interface
        function showDatabaseLoading() {
            document.getElementById('database-content').innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="spinner"></div><p>Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p></div>';
        }

        function showDatabaseSuccess(message) {
            document.getElementById('database-content').innerHTML = `<div style="text-align: center; padding: 2rem;"><i data-feather="check-circle" style="font-size: 3rem; color: var(--accent-green); margin-bottom: 1rem;"></i><p style="color: var(--accent-green);">${message}</p></div>`;
            feather.replace();
        }

        function showDatabaseError(message) {
            document.getElementById('database-content').innerHTML = `<div style="text-align: center; padding: 2rem;"><i data-feather="alert-circle" style="font-size: 3rem; color: var(--accent-red); margin-bottom: 1rem;"></i><p style="color: var(--accent-red);">${message}</p></div>`;
            feather.replace();
        }

        window.saveAllSettings = function() {
            // Trigger save for all visible forms
            const activeTab = document.querySelector('.tab-content:not(.hidden)');
            const form = activeTab?.querySelector('form');
            if (form) {
                form.submit();
            } else {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ø­ÙØ¸ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ¨ÙˆÙŠØ¨');
            }
        };

        // Remote Storage Management Functions
        window.testRemoteConnection = function() {
            const statusDiv = document.getElementById('remote-storage-status');
            const protocol = document.querySelector('[name="remote_storage_protocol"]')?.value;
            const host = document.querySelector('[name="remote_storage_host"]')?.value;
            const username = document.querySelector('[name="remote_storage_username"]')?.value;
            const password = document.querySelector('[name="remote_storage_password"]')?.value;
            const path = document.querySelector('[name="remote_storage_path"]')?.value;
            const port = document.querySelector('[name="remote_storage_port"]')?.value;
            
            if (!protocol || !host || !username) {
                statusDiv.innerHTML = '<span style="color: var(--accent-danger);">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© / Please fill all required fields</span>';
                return;
            }
            
            statusDiv.innerHTML = '<span style="color: var(--accent-warning);">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„... / Testing connection...</span>';
            
            fetch('/api/remote-mount-test', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    protocol: protocol,
                    host: host,
                    username: username,
                    password: password,
                    path: path || '/',
                    port: parseInt(port) || null
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.innerHTML = `<span style="color: var(--accent-green);">âœ“ ${data.message}</span>`;
                    if (data.test_files) {
                        statusDiv.innerHTML += `<br><small>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© / Files found: ${data.test_files.join(', ')}</small>`;
                    }
                } else {
                    statusDiv.innerHTML = `<span style="color: var(--accent-danger);">âœ— Ø®Ø·Ø£ / Error: ${data.error}</span>`;
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<span style="color: var(--accent-danger);">âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© / Network error: ${error}</span>`;
            });
        };

        window.viewMountStatus = function() {
            const statusDiv = document.getElementById('remote-storage-status');
            statusDiv.innerHTML = '<span style="color: var(--accent-warning);">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„... / Loading mount status...</span>';
            
            fetch('/api/remote-mount-status')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let statusText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª / Total mounts: ${data.total_mounts}<br>`;
                    if (data.mounts && data.mounts.length > 0) {
                        data.mounts.forEach(mount => {
                            const statusColor = mount.status === 'active' ? 'var(--accent-green)' : 'var(--accent-danger)';
                            statusText += `<span style="color: ${statusColor};">${mount.mount_point} (${mount.protocol}) - ${mount.status}</span><br>`;
                        });
                    } else {
                        statusText += 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ù…ÙŠÙ„Ø§Øª Ù†Ø´Ø·Ø© / No active mounts';
                    }
                    statusDiv.innerHTML = statusText;
                } else {
                    statusDiv.innerHTML = `<span style="color: var(--accent-danger);">Ø®Ø·Ø£ / Error: ${data.error}</span>`;
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<span style="color: var(--accent-danger);">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© / Network error: ${error}</span>`;
            });
        };

        window.unmountRemote = function() {
            const mountPoint = document.querySelector('[name="remote_storage_mount_point"]')?.value || '/mnt/remote';
            const statusDiv = document.getElementById('remote-storage-status');
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŸ / Are you sure you want to unmount?')) {
                return;
            }
            
            statusDiv.innerHTML = '<span style="color: var(--accent-warning);">Ø¬Ø§Ø±ÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„... / Unmounting...</span>';
            
            fetch('/api/remote-mount-unmount', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    mount_point: mountPoint
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.innerHTML = `<span style="color: var(--accent-green);">âœ“ ${data.message}</span>`;
                } else {
                    statusDiv.innerHTML = `<span style="color: var(--accent-danger);">âœ— Ø®Ø·Ø£ / Error: ${data.error}</span>`;
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<span style="color: var(--accent-danger);">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© / Network error: ${error}</span>`;
            });
        };

        // Event listeners for remote storage controls
        const testBtn = document.getElementById('test-remote-connection');
        const statusBtn = document.getElementById('view-mount-status');
        const unmountBtn = document.getElementById('unmount-remote');
        
        if (testBtn) testBtn.addEventListener('click', testRemoteConnection);
        if (statusBtn) statusBtn.addEventListener('click', viewMountStatus);
        if (unmountBtn) unmountBtn.addEventListener('click', unmountRemote);

        // File browser global variables
        let currentFileBrowserTarget = null;
        let currentBrowserPath = '/';

        // File browser functions
        function showFileBrowser(initialPath = '/') {
            const modal = document.getElementById('file-browser-modal');
            if (!modal) {
                console.error('File browser modal not found');
                return;
            }
            
            currentBrowserPath = initialPath;
            document.getElementById('current-path').textContent = initialPath;
            document.getElementById('selected-path').textContent = initialPath;
            
            modal.style.display = 'flex';
            loadFolders(initialPath);
        }

        function closeFileBrowser() {
            const modal = document.getElementById('file-browser-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function selectPath() {
            if (currentFileBrowserTarget && currentBrowserPath) {
                const targetInput = document.getElementById(currentFileBrowserTarget);
                if (targetInput) {
                    targetInput.value = currentBrowserPath;
                    targetInput.dispatchEvent(new Event('change')); // Trigger change event
                }
            }
            closeFileBrowser();
        }

        // Browse button event handler - universal for all sections  
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up file browser...');
            
            // Add click event for all browse buttons
            document.addEventListener('click', function(e) {
                const browseBtn = e.target.closest('.browse-btn');
                if (browseBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const targetId = browseBtn.getAttribute('data-target');
                    console.log('Browse button clicked for:', targetId);
                    
                    if (targetId) {
                        currentFileBrowserTarget = targetId;
                        
                        const input = document.getElementById(targetId);
                        let initialPath = input ? input.value.trim() : '';
                        if (!initialPath || initialPath === '') {
                            initialPath = '/';
                        }
                        
                        console.log('Opening file browser with path:', initialPath);
                        showFileBrowser(initialPath);
                    } else {
                        console.error('No data-target found on browse button');
                    }
                }
            });
            
            // Debug: Log all browse buttons found
            setTimeout(() => {
                const allBrowseButtons = document.querySelectorAll('.browse-btn');
                console.log('Found browse buttons:', allBrowseButtons.length);
                allBrowseButtons.forEach((btn, index) => {
                    const target = btn.getAttribute('data-target');
                    console.log(`Button ${index + 1}: target="${target}"`);
                });
            }, 1000);
        });

        function loadFolders(path) {
            const loadingDiv = document.getElementById('folder-loading');
            const folderList = document.getElementById('folder-list');
            
            loadingDiv.style.display = 'flex';
            folderList.innerHTML = '';
            
            // Real API call to browse folders
            fetch('/api/browse-folders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ path: path })
            })
            .then(response => response.json())
            .then(data => {
                loadingDiv.style.display = 'none';
                
                if (data.success) {
                    folderList.innerHTML = '';
                    
                    // Add parent directory option
                    if (path !== '/') {
                        const parentPath = path.split('/').slice(0, -1).join('/') || '/';
                        const parentItem = createFolderItem('..', parentPath, true);
                        folderList.appendChild(parentItem);
                    }
                    
                    // Add folders
                    data.folders.forEach(folder => {
                        const folderItem = createFolderItem(folder.name, folder.path, false);
                        folderList.appendChild(folderItem);
                    });
                } else {
                    folderList.innerHTML = '<li style="padding: 15px; color: var(--text-error);">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª: ' + data.error + '</li>';
                }
            })
            .catch(error => {
                loadingDiv.style.display = 'none';
                folderList.innerHTML = '<li style="padding: 15px; color: var(--text-error);">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</li>';
                console.error('Error loading folders:', error);
            });
        }

        function createFolderItem(name, path, isParent) {
            const li = document.createElement('li');
            li.className = 'folder-item';
            li.onclick = () => selectFolder(path, li);
            
            li.innerHTML = `
                <div class="folder-icon">
                    <i data-feather="${isParent ? 'arrow-up' : 'folder'}"></i>
                </div>
                <div class="folder-name">${name}</div>
            `;
            
            // Double click to navigate
            li.ondblclick = () => {
                if (isParent || name !== '..') {
                    navigateToFolder(path);
                }
            };
            
            return li;
        }

        function selectFolder(path, element) {
            // Remove previous selections
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Select current item
            element.classList.add('selected');
            currentBrowserPath = path;
            document.getElementById('selected-path').textContent = path;
        }

        function navigateToFolder(path) {
            currentBrowserPath = path;
            document.getElementById('current-path').textContent = path;
            document.getElementById('selected-path').textContent = path;
            loadFolders(path);
        }

        function generateMockFolders(path) {
            // Mock folder structure - replace with actual API call
            const commonFolders = {
                '/': [
                    { name: 'home', path: '/home' },
                    { name: 'mnt', path: '/mnt' },
                    { name: 'opt', path: '/opt' },
                    { name: 'var', path: '/var' },
                    { name: 'usr', path: '/usr' }
                ],
                '/home': [
                    { name: 'user', path: '/home/user' },
                    { name: 'shared', path: '/home/shared' }
                ],
                '/mnt': [
                    { name: 'remote', path: '/mnt/remote' },
                    { name: 'storage', path: '/mnt/storage' }
                ],
                '/mnt/remote': [
                    { name: 'movies', path: '/mnt/remote/movies' },
                    { name: 'series', path: '/mnt/remote/series' },
                    { name: 'downloads', path: '/mnt/remote/downloads' }
                ]
            };
            
            return commonFolders[path] || [];
        }

        // File browser modal handling - deferred until needed
        function initFileModal() {
            const modal = document.getElementById('file-browser-modal');
            if (modal && !modal.hasEventListener) {
                modal.onclick = function(e) {
                    if (e.target === this) {
                        closeFileBrowser();
                    }
                };
                modal.hasEventListener = true;
            }
        }

        // Development Tools Functions - Optimized with loading states
        window.createSampleTranslationLogs = function() {
            updateDevelopmentStatus('Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„Ø§Øª ØªØ±Ø¬Ù…Ø© ÙˆÙ‡Ù…ÙŠØ©...');
            
            // Disable button during operation
            const btn = event.target;
            btn.disabled = true;
            
            fetch('/api/create_sample_translation_logs', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${data.count} Ø³Ø¬Ù„ ØªØ±Ø¬Ù…Ø© ÙˆÙ‡Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø¬Ù„Ø§Øª'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            })
            .finally(() => {
                btn.disabled = false;
            });
        };

        window.createSampleMediaFiles = function() {
            updateDevelopmentStatus('Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª ÙˆØ³Ø§Ø¦Ø· ÙˆÙ‡Ù…ÙŠØ©...');
            
            fetch('/api/create_sample_media_files', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${data.count} Ù…Ù„Ù ÙˆØ³Ø§Ø¦Ø· ÙˆÙ‡Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            });
        };

        window.createSampleBlacklist = function() {
            updateDevelopmentStatus('Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø³ÙˆØ¯Ø§Ø¡ ÙˆÙ‡Ù…ÙŠØ©...');
            
            fetch('/api/create_sample_blacklist', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${data.count} Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            });
        };

        window.clearSampleMediaFiles = function() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŸ')) return;
            
            updateDevelopmentStatus('Ù…Ø³Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©...');
            
            fetch('/api/clear_sample_media_files', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø­Ø°Ù ${data.count} Ù…Ù„Ù ÙˆÙ‡Ù…ÙŠ`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            });
        };

        window.clearSampleBlacklist = function() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŸ')) return;
            
            updateDevelopmentStatus('Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©...');
            
            fetch('/api/clear_sample_blacklist', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø­Ø°Ù ${data.count} Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            });
        };

        window.clearSampleTranslationLogs = function() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŸ')) return;
            
            updateDevelopmentStatus('Ù…Ø³Ø­ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©...');
            
            const btn = event.target;
            btn.disabled = true;
            
            fetch('/api/clear_sample_translation_logs', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDevelopmentStatus(`ØªÙ… Ø­Ø°Ù ${data.count} Ø³Ø¬Ù„ ØªØ±Ø¬Ù…Ø© ÙˆÙ‡Ù…ÙŠ`);
                } else {
                    updateDevelopmentStatus(`Ø®Ø·Ø£: ${data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª'}`);
                }
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            })
            .finally(() => {
                btn.disabled = false;
            });
        };

        window.clearAllSampleData = function() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© (Ù…Ù„ÙØ§ØªØŒ Ù‚ÙˆØ§Ø¦Ù… Ø³ÙˆØ¯Ø§Ø¡ØŒ Ø³Ø¬Ù„Ø§Øª)ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) return;
            
            updateDevelopmentStatus('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©...');
            
            const btn = event.target;
            btn.disabled = true;
            
            // Call multiple APIs sequentially
            Promise.all([
                fetch('/api/clear_sample_media_files', { method: 'POST', credentials: 'include' }),
                fetch('/api/clear_sample_blacklist', { method: 'POST', credentials: 'include' }),
                fetch('/api/clear_sample_translation_logs', { method: 'POST', credentials: 'include' })
            ])
            .then(responses => Promise.all(responses.map(r => r.json())))
            .then(results => {
                const totalCleared = results.reduce((sum, result) => sum + (result.count || result.deleted_count || 0), 0);
                updateDevelopmentStatus(`ØªÙ… Ø­Ø°Ù ${totalCleared} Ø¹Ù†ØµØ± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©`);
            })
            .catch(error => {
                updateDevelopmentStatus(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
            })
            .finally(() => {
                btn.disabled = false;
            });
        };

        function updateDevelopmentStatus(message) {
            const statusDiv = document.getElementById('development-status');
            if (statusDiv) {
                statusDiv.textContent = message;
                
                // Auto-clear status after 3 seconds if it's a success message (reduced time)
                if (message.includes('ØªÙ…') || message.includes('Ø¨Ù†Ø¬Ø§Ø­')) {
                    setTimeout(() => {
                        if (statusDiv.textContent === message) { // Only clear if message hasn't changed
                            statusDiv.textContent = 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…';
                        }
                    }, 3000);
                }
            }
        }

        // Performance optimization: Cache frequently accessed elements
        let cachedElements = {};
        function getCachedElement(id) {
            if (!cachedElements[id]) {
                cachedElements[id] = document.getElementById(id);
            }
            return cachedElements[id];
        }

        // Add event listeners for browse buttons using data-target
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('browse-btn') && e.target.hasAttribute('data-target')) {
                const targetField = e.target.getAttribute('data-target');
                if (window.openFileBrowser && typeof window.openFileBrowser === 'function') {
                    window.openFileBrowser(targetField);
                } else {
                    console.error('openFileBrowser function not found');
                }
            }
        });

        // Optimize Feather Icons loading - defer until page is fully loaded
        // Ø¥ØµÙ„Ø§Ø­ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function fixDropdownOptions() {
            const currentLang = '{{ session.get("language", "ar") }}';
            
            document.querySelectorAll('select').forEach(select => {
                Array.from(select.options).forEach(option => {
                    const text = option.textContent.trim();
                    
                    // Ø¥ØµÙ„Ø§Ø­ Ø®ÙŠØ§Ø±Ø§Øª Ù†Ø¹Ù…/Ù„Ø§
                    if (text.includes('Ù†Ø¹Ù…') && text.includes('Yes')) {
                        option.textContent = currentLang === 'ar' ? 'Ù†Ø¹Ù…' : 'Yes';
                    } else if (text.includes('Ù„Ø§') && text.includes('No')) {
                        option.textContent = currentLang === 'ar' ? 'Ù„Ø§' : 'No';
                    }
                    // Ø¥ØµÙ„Ø§Ø­ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø±
                    else if (text.includes('Ø¯Ø§ÙƒÙ†') && text.includes('Dark')) {
                        option.textContent = currentLang === 'ar' ? 'Ø¯Ø§ÙƒÙ†' : 'Dark';
                    } else if (text.includes('ÙØ§ØªØ­') && text.includes('Light')) {
                        option.textContent = currentLang === 'ar' ? 'ÙØ§ØªØ­' : 'Light';
                    } else if (text.includes('Ø§Ù„Ù†Ø¸Ø§Ù…') && text.includes('System')) {
                        option.textContent = currentLang === 'ar' ? 'Ø§Ù„Ù†Ø¸Ø§Ù…' : 'System';
                    }
                    // Ø¥ØµÙ„Ø§Ø­ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù„ØºØ©
                    else if (text.includes('Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©') && text.includes('Arabic')) {
                        option.textContent = currentLang === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Arabic';
                    } else if (text.includes('Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©') && text.includes('English')) {
                        option.textContent = currentLang === 'ar' ? 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'English';
                    }
                });
            });
        }

        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
                // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                fixDropdownOptions();
            }, 500);
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø³Ù…
        const categorySelect = document.getElementById('category');
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                setTimeout(fixDropdownOptions, 300);
            });
        }

        // Function to refresh GPU options dynamically

        // Function to update GPU dropdowns with new options
        function updateGPUDropdowns(gpuOptions) {
            const gpuSelects = document.querySelectorAll('select[name="whisper_model_gpu"], select[name="ollama_model_gpu"]');
            
            gpuSelects.forEach(select => {
                const currentValue = select.value;
                
                // Clear existing options
                select.innerHTML = '';
                
                // Add new options
                gpuOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.label;
                    
                    // Restore selected value if it still exists
                    if (option.value === currentValue) {
                        optionElement.selected = true;
                    }
                    
                    select.appendChild(optionElement);
                });
                
                // If current value doesn't exist anymore, select 'auto'
                if (!Array.from(select.options).some(opt => opt.value === currentValue)) {
                    select.value = 'auto';
                }
            });
            
            console.log('GPU dropdown options updated with', gpuOptions.length, 'options');
        }

        // Show notification function
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.gpu-notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `gpu-notification notification ${type}`;
            notification.textContent = message;
            
            // Add CSS styles inline
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                padding: 15px 20px;
                border-radius: 8px;
                font-weight: 600;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
                color: white;
                background: ${type === 'success' ? 'linear-gradient(135deg, #2ecc71, #27ae60)' : 
                            type === 'error' ? 'linear-gradient(135deg, #e74c3c, #c0392b)' : 
                            'linear-gradient(135deg, #3498db, #2980b9)'};
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // Smart GPU Allocation function

        // GPU Diagnosis Modal function

        // Display diagnosis results
        function displayDiagnosis(diagnosis) {
            const isArabic = document.querySelector('html[lang="ar"]');
            const content = document.getElementById('diagnosisContent');
            
            let statusHtml = '<div style="display: grid; gap: 20px;">';
            
            // NVIDIA Driver Status
            statusHtml += `
                <div style="padding: 20px; border-radius: 12px; background: ${diagnosis.nvidia_driver_installed ? '#d4edda' : '#f8d7da'}; border: 2px solid ${diagnosis.nvidia_driver_installed ? '#28a745' : '#dc3545'};">
                    <h4 style="margin: 0 0 10px 0; color: ${diagnosis.nvidia_driver_installed ? '#155724' : '#721c24'};">
                        <i data-feather="${diagnosis.nvidia_driver_installed ? 'check-circle' : 'x-circle'}" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                        ${isArabic ? 'ØªØ¹Ø±ÙŠÙØ§Øª NVIDIA' : 'NVIDIA Drivers'}
                    </h4>
                    <p style="margin: 0; color: ${diagnosis.nvidia_driver_installed ? '#155724' : '#721c24'};">
                        ${diagnosis.nvidia_driver_installed ? 
                            (isArabic ? 'Ù…Ø«Ø¨ØªØ© Ø¨Ù†Ø¬Ø§Ø­' : 'Installed successfully') + (diagnosis.driver_version ? ` (${diagnosis.driver_version})` : '') :
                            (isArabic ? 'ØºÙŠØ± Ù…Ø«Ø¨ØªØ©' : 'Not installed')
                        }
                    </p>
                </div>
            `;
            
            // CUDA Status
            statusHtml += `
                <div style="padding: 20px; border-radius: 12px; background: ${diagnosis.cuda_installed ? '#d4edda' : '#f8d7da'}; border: 2px solid ${diagnosis.cuda_installed ? '#28a745' : '#dc3545'};">
                    <h4 style="margin: 0 0 10px 0; color: ${diagnosis.cuda_installed ? '#155724' : '#721c24'};">
                        <i data-feather="${diagnosis.cuda_installed ? 'check-circle' : 'x-circle'}" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                        CUDA Toolkit
                    </h4>
                    <p style="margin: 0; color: ${diagnosis.cuda_installed ? '#155724' : '#721c24'};">
                        ${diagnosis.cuda_installed ? 
                            (isArabic ? 'Ù…Ø«Ø¨Øª Ø¨Ù†Ø¬Ø§Ø­' : 'Installed successfully') + (diagnosis.cuda_version ? ` (${diagnosis.cuda_version})` : '') :
                            (isArabic ? 'ØºÙŠØ± Ù…Ø«Ø¨Øª' : 'Not installed')
                        }
                    </p>
                </div>
            `;
            
            // GPU Detection Status
            statusHtml += `
                <div style="padding: 20px; border-radius: 12px; background: ${diagnosis.gpu_detected ? '#d4edda' : '#fff3cd'}; border: 2px solid ${diagnosis.gpu_detected ? '#28a745' : '#ffc107'};">
                    <h4 style="margin: 0 0 10px 0; color: ${diagnosis.gpu_detected ? '#155724' : '#856404'};">
                        <i data-feather="${diagnosis.gpu_detected ? 'check-circle' : 'alert-triangle'}" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                        ${isArabic ? 'ÙƒØ´Ù ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©' : 'GPU Detection'}
                    </h4>
                    <p style="margin: 0; color: ${diagnosis.gpu_detected ? '#155724' : '#856404'};">
                        ${diagnosis.gpu_detected ? 
                            (isArabic ? `ØªÙ… ÙƒØ´Ù ${diagnosis.gpu_count} ÙƒØ§Ø±Øª Ø´Ø§Ø´Ø©` : `${diagnosis.gpu_count} GPU(s) detected`) :
                            (isArabic ? 'Ù„Ù… ÙŠØªÙ… ÙƒØ´Ù Ø£ÙŠ ÙƒØ±ÙˆØª Ø´Ø§Ø´Ø©' : 'No GPUs detected')
                        }
                    </p>
                </div>
            `;
            
            statusHtml += '</div>';
            
            // Recommendations
            if (diagnosis.recommendations && diagnosis.recommendations.length > 0) {
                statusHtml += `
                    <div style="margin-top: 30px; padding: 25px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #007bff;">
                        <h4 style="margin: 0 0 15px 0; color: #0056b3;">
                            <i data-feather="info" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                            ${isArabic ? 'Ø§Ù„ØªÙˆØµÙŠØ§Øª' : 'Recommendations'}
                        </h4>
                        <ul style="margin: 0; padding-left: 20px;">
                `;
                
                diagnosis.recommendations.forEach(rec => {
                    statusHtml += `<li style="margin-bottom: 8px; color: #495057;">${rec}</li>`;
                });
                
                statusHtml += '</ul></div>';
            }
            
            // Installation script button
            statusHtml += `
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="downloadInstallationScript()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 1.1em; font-weight: 600; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);">
                        <i data-feather="download" style="width: 20px; height: 20px; margin-right: 10px;"></i>
                        ${isArabic ? 'ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„ØªØ«Ø¨ÙŠØª' : 'Download Installation Script'}
                    </button>
                </div>
            `;
            
            content.innerHTML = statusHtml;
            feather.replace();
        }

        // Download installation script
        function downloadInstallationScript() {
            fetch('/api/gpu-installation-script')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const blob = new Blob([data.script], { type: 'text/plain' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'gpu_setup_installer.sh';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        showNotification(
                            document.querySelector('html[lang="ar"]') ? 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­' : 'Installation script downloaded successfully',
                            'success'
                        );
                    } else {
                        showNotification(
                            document.querySelector('html[lang="ar"]') ? 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„ØªØ«Ø¨ÙŠØª' : 'Failed to download installation script',
                            'error'
                        );
                    }
                })
                .catch(error => {
                    console.error('Error downloading script:', error);
                    showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„ØªØ«Ø¨ÙŠØª', 'error');
                });
        }

        // Close diagnosis modal
        function closeGPUDiagnosis() {
            const modal = document.getElementById('gpuDiagnosisModal');
            if (modal) {
                modal.remove();
            }
        }

        // Load GPU status when switching to GPU section

        // Show GPU error
        function showGPUError(error) {
            statusDisplay.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i data-feather="alert-circle" style="width: 48px; height: 48px; color: #e74c3c;"></i>
                    <p style="margin-top: 20px; color: #e74c3c;">${error}</p>
                </div>
            `;
            feather.replace();
        }

        // Refresh GPU options when switching to AI category or GPU section
        const originalSwitchCategory = switchCategory;
        window.switchCategory = function() {
            originalSwitchCategory();
            const categorySelect = document.getElementById('category-select');
            if (categorySelect && categorySelect.value === 'ai') {
            }
        };

        // Override switchToTab to load GPU status when switching to GPU tab
        const originalSwitchToTab = switchToTab;
        window.switchToTab = function(tabName) {
            originalSwitchToTab(tabName);
            if (tabName === 'gpu') {
            }
        };

    });


</script>

<!-- File browser modal is now included from layout.html -->
{% endblock %}
<script>
// GPU Management Functions
function refreshGPUOptions() {
    console.log('Refreshing GPU options...');
    
    fetch('/api/gpu/refresh', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update GPU dropdowns with new options
            updateGPUDropdowns(data.gpus);
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
            showNotification('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©: ' + (data.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'), 'error');
        }
    })
    .catch(error => {
        console.error('Error refreshing GPU options:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
    });
}

function smartGPUAllocation() {
    console.log('Running smart GPU allocation...');
    
    fetch('/api/gpu/auto-allocate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update form fields with smart allocation
            if (data.allocation) {
                const whisperSelect = document.getElementById('whisper_model_gpu');
                const ollamaSelect = document.getElementById('ollama_model_gpu');
                
                if (whisperSelect && data.allocation.whisper) {
                    whisperSelect.value = data.allocation.whisper;
                }
                if (ollamaSelect && data.allocation.ollama) {
                    ollamaSelect.value = data.allocation.ollama;
                }
                
                showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        } else {
            showNotification('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ: ' + (data.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'), 'error');
        }
    })
    .catch(error => {
        console.error('Error in smart GPU allocation:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
    });
}

function updateGPUDropdowns(gpus) {
    // Update GPU options in select elements
    const gpuSelects = document.querySelectorAll('.gpu-select');
    
    gpuSelects.forEach(select => {
        // Keep auto and cpu options, update GPU options
        const currentValue = select.value;
        
        // Clear GPU options but keep auto and cpu
        const options = Array.from(select.options);
        options.forEach(option => {
            if (!['auto', 'cpu'].includes(option.value)) {
                option.remove();
            }
        });
        
        // Add new GPU options
        gpus.forEach((gpu, index) => {
            const option = document.createElement('option');
            option.value = index.toString();
            option.textContent = `GPU ${index}: ${gpu.name} (${Math.round(gpu.memory_total/1024)}GB)`;
            select.appendChild(option);
        });
        
        // Restore previous value if still valid
        if (Array.from(select.options).some(opt => opt.value === currentValue)) {
            select.value = currentValue;
        }
    });
}

// Old GPU functions removed - using window.* versions instead

function showNotification(message, type = 'info') {
    // Simple notification function
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        z-index: 10000;
        max-width: 400px;
        background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}

// GPU Management Functions - Define globally
function refreshGPUOptions() {
    console.log('Refreshing GPU options...');
    showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©...', 'info');
    
    fetch('/api/gpu/refresh')
    .then(response => response.json())
    .then(data => {
        console.log('GPU refresh response:', data);
        if (data.success) {
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => window.location.reload(), 1000);
        } else {
            showNotification('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©', 'error');
        }
    })
    .catch(error => {
        console.error('Error refreshing GPU options:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©', 'error');
    });
}

function smartGPUAllocation() {
    console.log('Running smart GPU allocation...');
    showNotification('Ø¬Ø§Ø±ÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©...', 'info');
    
    fetch('/api/gpu/smart-allocation', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('Smart allocation response:', data);
        if (data.success) {
            showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            let allocationText = '=== Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø·Ø¨Ù‚ ===\n\n';
            allocationText += `Whisper: ${data.allocation.whisper}\n`;
            allocationText += `Ollama: ${data.allocation.ollama}\n`;
            allocationText += `Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©: ${data.allocation.strategy}\n\n`;
            allocationText += 'Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...';
            
            alert(allocationText);
            setTimeout(() => window.location.reload(), 2000);
        } else {
            showNotification('ÙØ´Ù„ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ', 'error');
        }
    })
    .catch(error => {
        console.error('Error in smart GPU allocation:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©', 'error');
    });
}

function showGPUDiagnosis() {
    console.log('Running GPU diagnosis...');
    
    fetch('/api/gpu/status')
    .then(response => response.json())
    .then(data => {
        console.log('GPU status response:', data);
        let diagnosisText = '=== ØªØ´Ø®ÙŠØµ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø© ===\n\n';
        
        if (data.nvidia_available) {
            diagnosisText += `âœ“ NVIDIA Ù…ØªØ§Ø­: Ù†Ø¹Ù…\n`;
            diagnosisText += `âœ“ Ø¹Ø¯Ø¯ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©: ${data.total_gpus}\n\n`;
            
            if (data.gpus && data.gpus.length > 0) {
                data.gpus.forEach((gpu, index) => {
                    diagnosisText += `--- ÙƒØ§Ø±Øª Ø§Ù„Ø´Ø§Ø´Ø© ${index} ---\n`;
                    diagnosisText += `Ø§Ù„Ø§Ø³Ù…: ${gpu.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n`;
                    diagnosisText += `Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${Math.round((gpu.memory_total || 0)/1024)}GB\n`;
                    diagnosisText += `Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: ${gpu.utilization || 0}%\n`;
                    diagnosisText += `Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${gpu.temperature || 0}Â°C\n\n`;
                });
            }
        } else {
            diagnosisText += `âœ— NVIDIA Ù…ØªØ§Ø­: Ù„Ø§\n`;
            diagnosisText += `âœ— Ø¹Ø¯Ø¯ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©: 0\n\n`;
            diagnosisText += `Ø§Ù„ØªÙˆØµÙŠØ§Øª:\n`;
            diagnosisText += `- ØªØ«Ø¨ÙŠØª ØªØ¹Ø±ÙŠÙØ§Øª NVIDIA\n`;
            diagnosisText += `- ØªØ«Ø¨ÙŠØª CUDA toolkit\n`;
            diagnosisText += `- Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…\n`;
        }
        
        alert(diagnosisText);
    })
    .catch(error => {
        console.error('Error in GPU diagnosis:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ´Ø®ÙŠØµ ÙƒØ±ÙˆØª Ø§Ù„Ø´Ø§Ø´Ø©', 'error');
    });
}

console.log('GPU management functions defined globally');
</script>
